#textdomain wesnoth-Undead_in_the_Sewers
[scenario]
    id=Sewer_Level_1_2
    name= _ "Sewer Level 1"
    next_scenario=Sewer_Level_2
    map_data="{~add-ons/Undead_in_the_Sewers/maps/Level_1_2.map}"
    turns=-1
    {UNDERGROUND}
    [+time]
        red,green,blue=-50,-50,-50
    [/time]

    {SCENARIO_MUSIC "ambient/sewer_1.ogg"}
    victory_when_enemies_defeated=no

    [event]
        name=die
        [filter]
            side=2
        [/filter]

        [store_unit]
            [filter]
                id=$unit.id
            [/filter]
            kill=yes
            animate=yes
            variable=locator
        [/store_unit]

        [store_locations]
            variable=bad_locations
            add=$locator.x,$locator.y
        [/store_locations]

        {CLEAR_VARIABLE locator}
    [/event]

    [event]
        name=preload
        first_time_only=no
        [lua]
            code=<<
    helper = wesnoth.require("lua/helper.lua")
    wesnoth.dofile("~add-ons/Undead_in_the_Sewers/lua/wml_tags.lua")
    >>
        [/lua]
    [/event]

    [event]
        name=prestart
        [objectives]
            side=1
            [objective]
                description= _ "Enter the next level"
                condition=win
            [/objective]
            [objective]
                description= _ "You die"
                condition=lose
            [/objective]

            note={NEW_GOLD_CARRYOVER_NOTE_100}
        [/objectives]
    [/event]

    [side]
        type=Stupid
        id=Stupid
        name= _ "Stupid"
        side=1
        income=-2
        x,y=17,6
        village_gold=0
        gold=0
        shroud=yes
        fog=yes
        canrecruit=yes
        controller=human
        team_name=Player
        user_team_name=_ "Player"
    [/side]

    [side]
        no_leader=yes
        side=2
        income=0
        village_gold=0
        team_name=Undead
        user_team_name=_ "Undead"
        [ai]
            agression=1
            caution=0
            village_value=0
            grouping=offensive

            [goal]
                [criteria]
                    side=1
                    id=$player.id
                [/criteria]
                value=9
            [/goal]
            {AI_SIMPLE_ALWAYS_ASPECT combat_ignore_bad_movements yes}
            {AI_SIMPLE_ALWAYS_ASPECT combat_ignore_bad_combat yes}
            {AI_SIMPLE_ALWAYS_ASPECT aggression 0.9}
            {AI_SIMPLE_ALWAYS_ASPECT caution 0.0}
        [/ai]
    [/side]

    [side]
        no_leader=yes
        side=3
        income=0
        village_gold=0
        shroud=yes
        fog=yes
        team_name=Lizards
        user_team_name=_ "Lizards"
        [ai]
            village_value=0
            agression=9
            caution=0
            {AI_SIMPLE_ALWAYS_ASPECT recruitment_ignore_bad_movements yes}
            {AI_SIMPLE_ALWAYS_ASPECT recruitment_ignore_bad_combat yes}
            {AI_SIMPLE_ALWAYS_ASPECT aggression 0.9}
            {AI_SIMPLE_ALWAYS_ASPECT caution 0.0}
        [/ai]
    [/side]

    [side]
        no_leader=yes
        side=4
        income=0
        village_gold=0
        shroud=yes
        fog=yes
        team_name=Mushrooms
        user_team_name=_ "Mushrooms"
        [ai]
            village_value=0
            agression=9
            caution=0
            {AI_SIMPLE_ALWAYS_ASPECT recruitment_ignore_bad_movements yes}
            {AI_SIMPLE_ALWAYS_ASPECT recruitment_ignore_bad_combat yes}
            {AI_SIMPLE_ALWAYS_ASPECT aggression 0.9}
            {AI_SIMPLE_ALWAYS_ASPECT caution 0.0}
        [/ai]
    [/side]

    {ANIMATED_BRAZIER 25 34}

    {ANIMATED_BRAZIER 11 24}

    {ANIMATED_BRAZIER 1 39}

    {ANIMATED_BRAZIER 28 19}

    {ANIMATED_BRAZIER 11 9}

    {LOCOMOTION_TRANSITION 31,52,25,49,29 34,34,20,6,13}

    {DANGEROUS_SEWAGE}

    [event]
        name=moveto
        [filter]
            id=$player.id
            [filter_location]
                x=52,52,53,52,52,53,52,53,53
                y=29,30,31,31,32,32,33,33,34
            [/filter_location]
        [/filter]

        [if]
            [variable]
                name=Sewer_level_1.fungus_tunnel_dialogue
                boolean_equals=yes
            [/variable]
            [then]
            [/then]
            [else]
                [message]
                    speaker=narrator
                    message= _ "As you near the mouth of the tunnel ahead, you hear the sounds of slithering, whispering voices, and guttural growling coming from the blackness. Whatever creatures lurk in the dark recesses ahead, they sound extremely dangerous, and you will probably want to make sure you are very experienced and at your strongest before entering this tunnel. Or, of course, you could just take a look around and make a run for it if things get too tough."
                    image=wesnoth-icon.png
                [/message]

                [set_variable]
                    name=Sewer_level_1.fungus_tunnel_dialogue
                    value=yes
                [/set_variable]
            [/else]
        [/if]
    [/event]

    [event]
        name=prestart

        [kill]
            id=Stupid
        [/kill]

        [unstore_unit]
            variable=player_interlevel
            x,y=17,6
            find_vacant=no
        [/unstore_unit]

        [set_shroud]
            side=1
            shroud_data=$Sewer_level_1.shroud_data
        [/set_shroud]

        [if]
            [variable]
                name=Sewer_level_1.second_gate_unlocked
                numerical_equals=2
            [/variable]
            [then]
            [/then]
            [else]
                [terrain]
                    x,y=30,20
                    terrain=Rb^Xo
                [/terrain]
            [/else]
        [/if]

        [terrain]
            x,y=7,4
            terrain=Urb^Xo
        [/terrain]

        [terrain]
            x,y=3,40
            terrain=Urb^Doo
        [/terrain]

        [terrain]
            x,y=52,5
            terrain=Urb^Doo
        [/terrain]

        [terrain]
            x=1 ,13,21
            y=22,20,36
            terrain=Uu^Doo
        [/terrain]

        [terrain]
            x,y=8,36
            terrain=Rb^Doo
        [/terrain]

        [set_variable]
            name=locomotion
            value=1
        [/set_variable]

        [if]
            [variable]
                name=Sewer_level_1.has_key_1
                numerical_equals=2
            [/variable]
            [then]
            [/then]
            [else]
                {PLACE_IMAGE "items/key.png" 6 24}
            [/else]
        [/if]

        {PLACE_IMAGE "scenery/brokenbarrel.png" 33 21}

        {PLACE_IMAGE "scenery/gate-rusty-se.png" 7 4}

        [if]
            [variable]
                name=Sewer_level_1.second_gate_unlocked
                numerical_equals=2
            [/variable]
            [then]
            [/then]
            [else]
                {PLACE_IMAGE "scenery/gate-rusty-se.png" 30 20}
            [/else]
        [/if]

        [if]
            [variable]
                name=Sewer_level_1.gate_unlocked
                numerical_equals=2
            [/variable]
            [then]
                [terrain]
                    x,y=28,35
                    terrain=Rb
                [/terrain]
            [/then]
            [else]
                {PLACE_IMAGE "scenery/gate-rusty-sw.png" 28 35}
            [/else]
        [/if]

        [if]
            [variable]
                name=trapdoor
                numerical_equals=2
            [/variable]
            [then]
                {PLACE_IMAGE "scenery/trapdoor-open.png" 33 18}
            [/then]
            [else]
                {PLACE_IMAGE "scenery/trapdoor-closed.png" 33 18}
            [/else]
        [/if]

        [if]
            [variable]
                name=Sewer_level_1.found_exit
                numerical_equals=2
            [/variable]
            [then]
                {PLACE_IMAGE "scenery/trapdoor-open.png" 17 6}
            [/then]
            [else]
                {PLACE_IMAGE "scenery/trapdoor-closed.png" 17 6}
            [/else]
        [/if]

        {PLACE_IMAGE "scenery/heavyinfantrie-statue-w.png" 4 33}

        {PLACE_IMAGE "scenery/heavyinfantrie-statue-w.png" 3 38}

        {PLACE_IMAGE "scenery/stairs-spiral.png" 2 39}

        {PLACE_IMAGE "scenery/stairs-spiral.png" 6 1}

        {PLACE_IMAGE "scenery/brokenbarrel.png" 6 38}

        {PLACE_IMAGE "scenery/brokenbarrel.png" 8 28}

        {PLACE_IMAGE "scenery/brokenpot.png" 14 34}

        {PLACE_IMAGE "scenery/trash.png" 52 11}

        {PLACE_IMAGE "scenery/trash.png" 52 12}
        {PLACE_IMAGE "scenery/trash.png" 53 13}

        {PLACE_IMAGE "scenery/trash.png" 53 12}

        {PLACE_IMAGE "scenery/trash.png" 53 11}

        {PLACE_IMAGE "scenery/trash.png" 54 12}

        {PLACE_IMAGE "scenery/trash.png" 54 11}

        #The rat you meet when you first start the level
        {NPC_SPAWN_CHECK "Giant Rat" rat1 6 37 ""}

        #Slightly harder zombie guarding the west passage next to the key room
        {NPC_SPAWN_CHECK "Walking Corpse" zombie1 1 25 ""}

        #The zombie just north of the starting point
        {NPC_SPAWN_CHECK "Walking Corpse" zombie2 7 34 ""}

        #The zombie in the swamp
        {NPC_SPAWN_CHECK "Walking Corpse" zombie3 16 29 ""}

        #The other zombie in the swamp
        {NPC_SPAWN_CHECK "Walking Corpse" zombie4 16 38 ""}

        #Slightly harder zombie guarding the locked door
        {NPC_SPAWN_CHECK "Soulless" soulless2 26 35 ""}

        #First zombie guarding the east passage to the key room
        {NPC_SPAWN_CHECK "Walking Corpse" zombie5 13 23 ""}

        #Second zombie guarding the east passage to the key room
        {NPC_SPAWN_CHECK "Walking Corpse" zombie6 9 21 ""}

        #The zombie that stares across the chasm, taunting the player
        {NPC_SPAWN_CHECK "Walking Corpse" zombie7 15 24 ""}

        #Swimming zombie
        {NPC_SPAWN_CHECK "Walking Corpse" zombie8 37 29 swimmer}

        #Swimming zombie nw of the island
        [if]
            [variable]
                name=zombie9_dead
                numerical_equals=2
            [/variable]
            [then]
            [/then]
            [else]
                [unit]
                    type=Walking Corpse
                    id=zombie9
                    side=2
                    variation=swimmer
                    x,y=26,17
                    ai_special=guardian
                [/unit]
            [/else]
        [/if]

        #Swimming zombie ne of the island
        [if]
            [variable]
                name=zombie10_dead
                numerical_equals=2
            [/variable]
            [then]
            [/then]
            [else]
                [unit]
                    type=Walking Corpse
                    id=zombie10
                    side=2
                    variation=swimmer
                    x,y=41,14
                    ai_special=guardian
                [/unit]
            [/else]
        [/if]

        #Swimming zombie in the channel leading to the bone testing hall
        [if]
            [variable]
                name=zombie11_dead
                numerical_equals=2
            [/variable]
            [then]
            [/then]
            [else]
                [unit]
                    type=Walking Corpse
                    id=zombie11
                    side=2
                    variation=swimmer
                    x,y=43,37
                    ai_special=guardian
                [/unit]
            [/else]
        [/if]

        #Slightly harder zombie just behind the gate in the nw hall
        [if]
            [variable]
                name=soulless3_dead
                numerical_equals=2
            [/variable]
            [then]
            [/then]
            [else]
                [unit]
                    id=soulless3
                    type=Soulless
                    side=2
                    x,y= 8,4
                [/unit]
            [/else]
        [/if]

        #Slgihtly harder zombie in the trapdoor room in the nw hall
        [if]
            [variable]
                name=soulless4_dead
                numerical_equals=2
            [/variable]
            [then]
            [/then]
            [else]
                [unit]
                    id=soulless4
                    type=Soulless
                    side=2
                    x,y= 16,6
                    ai_special=guardian
                [/unit]
            [/else]
        [/if]

        ######################### T U N N E L   C R E A T U R E S #################

        #1

        [if]
            [variable]
                name=Mushroom1_dead
                numerical_equals=2
            [/variable]
            [then]
            [/then]
            [else]
                [unit]
                    type=Sporeling
                    id=Mushroom1
                    side=4
                    x,y=50,24
                    ai_special=guardian
                [/unit]
            [/else]
        [/if]

        #2

        [if]
            [variable]
                name=Mushroom2_dead
                numerical_equals=2
            [/variable]
            [then]
            [/then]
            [else]
                [unit]
                    type=Fungoid
                    id=Mushroom2
                    side=4
                    x,y=46,25
                    ai_special=guardian
                [/unit]
            [/else]
        [/if]

        #3

        [if]
            [variable]
                name=Mushroom3_dead
                numerical_equals=2
            [/variable]
            [then]
            [/then]
            [else]
                [unit]
                    type=Sporeling
                    id=Mushroom3
                    side=4
                    x,y=50,19
                    ai_special=guardian
                [/unit]
            [/else]
        [/if]

        #4

        [if]
            [variable]
                name=Mushroom4_dead
                numerical_equals=2
            [/variable]
            [then]
            [/then]
            [else]
                [unit]
                    type=Giantstool
                    id=Mushroom4
                    side=4
                    x,y=53,22
                    ai_special=guardian
                [/unit]
            [/else]
        [/if]

        #5

        [if]
            [variable]
                name=Mushroom5_dead
                numerical_equals=2
            [/variable]
            [then]
            [/then]
            [else]
                [unit]
                    type=Sporeling
                    id=Mushroom5
                    side=4
                    x,y=59,24
                    ai_special=guardian
                [/unit]
            [/else]
        [/if]

        #6

        [if]
            [variable]
                name=Mushroom6_dead
                numerical_equals=2
            [/variable]
            [then]
            [/then]
            [else]
                [unit]
                    type=Fungoid
                    id=Mushroom6
                    side=4
                    x,y=60,27
                    ai_special=guardian
                [/unit]
            [/else]
        [/if]

        #7

        [if]
            [variable]
                name=Mushroom7_dead
                numerical_equals=2
            [/variable]
            [then]
            [/then]
            [else]
                [unit]
                    type=Sporeling
                    id=Mushroom7
                    side=4
                    x,y=64,28
                    ai_special=guardian
                [/unit]
            [/else]
        [/if]

        #8

        [if]
            [variable]
                name=Mushroom8_dead
                numerical_equals=2
            [/variable]
            [then]
            [/then]
            [else]
                [unit]
                    type=Sporeling
                    id=Mushroom8
                    side=4
                    x,y=66,24
                    ai_special=guardian
                [/unit]
            [/else]
        [/if]

        #9

        [if]
            [variable]
                name=Mushroom9_dead
                numerical_equals=2
            [/variable]
            [then]
            [/then]
            [else]
                [unit]
                    type=Sporeling
                    id=Mushroom9
                    side=4
                    x,y=62,33
                    ai_special=guardian
                [/unit]
            [/else]
        [/if]

        #10

        [if]
            [variable]
                name=Mushroom10_dead
                numerical_equals=2
            [/variable]
            [then]
            [/then]
            [else]
                [unit]
                    type=Fungoid
                    id=Mushroom10
                    side=4
                    x,y=66,22
                    ai_special=guardian
                [/unit]
            [/else]
        [/if]

        #11

        [if]
            [variable]
                name=Mushroom11_dead
                numerical_equals=2
            [/variable]
            [then]
            [/then]
            [else]
                [unit]
                    type=Sporeling
                    id=Mushroom11
                    side=4
                    x,y=58,16
                    ai_special=guardian
                [/unit]
            [/else]
        [/if]

        #12

        [if]
            [variable]
                name=Mushroom12_dead
                numerical_equals=2
            [/variable]
            [then]
            [/then]
            [else]
                [unit]
                    type=Giantstool
                    id=Mushroom12
                    side=4
                    x,y=66,15
                    ai_special=guardian
                [/unit]
            [/else]
        [/if]

        #13

        [if]
            [variable]
                name=Mushroom13_dead
                numerical_equals=2
            [/variable]
            [then]
            [/then]
            [else]
                [unit]
                    type=Fungoid
                    id=Mushroom13
                    side=4
                    x,y=63,12
                    ai_special=guardian
                [/unit]
            [/else]
        [/if]

        #14

        [if]
            [variable]
                name=Mushroom14_dead
                numerical_equals=2
            [/variable]
            [then]
            [/then]
            [else]
                [unit]
                    type=Giantstool
                    id=Mushroom14
                    side=4
                    x,y=65,8
                    ai_special=guardian
                [/unit]
            [/else]
        [/if]

        #15

        [if]
            [variable]
                name=Mushroom15_dead
                numerical_equals=2
            [/variable]
            [then]
            [/then]
            [else]
                [unit]
                    type=Fungoid
                    id=Mushroom15
                    side=4
                    x,y=66,3
                    ai_special=guardian
                [/unit]
            [/else]
        [/if]

        #16

        [if]
            [variable]
                name=Mushroom16_dead
                numerical_equals=2
            [/variable]
            [then]
            [/then]
            [else]
                [unit]
                    type=Giantstool
                    id=Mushroom16
                    side=4
                    x,y=60,3
                    ai_special=guardian
                [/unit]
            [/else]
        [/if]

        #17

        [if]
            [variable]
                name=Mushroom17_dead
                numerical_equals=2
            [/variable]
            [then]
            [/then]
            [else]
                [unit]
                    type=Giantstool
                    id=Mushroom17
                    side=4
                    x,y=63,1
                    ai_special=guardian
                [/unit]
            [/else]
        [/if]

        #Charybdis

        [if]
            [variable]
                name=Charybdis_dead
                numerical_equals=2
            [/variable]
            [then]
            [/then]
            [else]
                [unit]
                    type=Charybdis
                    ai_special=guardian
                    side=4
                    x,y=63,1
                [/unit]
            [/else]
        [/if]

        #check to see whether the bridge has already been lowered
        [if]
            [variable]
                name=Sewer_level_1.bridge_lowered
                numerical_equals=2
            [/variable]
            [then]
                [terrain]
                    x,y=2,32
                    terrain=Qxu^Bs|
                [/terrain]

                [terrain]
                    x,y=2,29
                    terrain=Qxu^Bs|
                [/terrain]
            [/then]
            [else]
            [/else]
        [/if]

        {SCROLL_TO 2 39}

        [redraw]
        [/redraw]
    [/event]

    {HP 1HP1 14 40}

    {HP 1HP2 4 25}

    {HP 1HP3 43 17}

    {HP 1HP4 26 14}

    [event]
        name=start

        {CLEAR_VARIABLE player_interlevel}

        {MENU_ITEMS}

        [sound_source]
            id=sign
            sounds=ambient/fire.ogg
            x=1 ,11,25,28,11
            y=39,24,34,19,9
            fade_range=4
            full_range=4
            loop=-1
            check_fogged=true
        [/sound_source]

        [if]
            [variable]
                name=Sewer_level_1.intro_dialogue_done
                numerical_equals=2
            [/variable]
            [then]
            [/then]
            [else]
                [message]
                    speaker=$player.id
                    message= _ "My, it sure stinks down here."
                [/message]

                [message]
                    speaker=$player.id
                    message= _ "It <i>really</i> stinks down here! Pfaugh!"
                [/message]

                [message]
                    speaker=$player.id
                    message= _ "Ugh. And there's so much moisture in the air, it creates sort of a fog down here. Double ugh."
                [/message]

                [message]
                    speaker=$player.id
                    message= _ "Wait, what's that pile of... No. No, it couldn't be... Aww come <i>on!</i>"
                [/message]

                [message]
                    speaker=$player.id
                    message= _ "Sigh. Well, after all, it <i>is</i> a sewer..."
                [/message]

                [set_variable]
                    name=Sewer_level_1.intro_dialogue_done
                    add=2
                [/set_variable]
            [/else]
        [/if]
    [/event]

    #Event for lowering the bridge across the south-western chasm

    [event]
        name=moveto
        [filter]
            x,y=4,33
            id=$player.id
        [/filter]

        [if]
            [variable]
                name=Sewer_level_1.bridge_lowered
                numerical_equals=2
            [/variable]
            [then]
            [/then]
            [else]
                [message]
                    speaker=narrator
                    message= _ "You come upon an old cracked statue from some bygone era, no doubt depicting a mighty warrior from long ago. There is a small metal plaque at the base of the statue, but rust and time have long ago hidden forever whatever was written there."
                [/message]

                [message]
                    speaker=narrator
                    message= _ "As you examine the statue, you accidentally hit its left foot with your hand. There is a muffled click, then a loud rumble of stone on stone, coming from the chasm behind you."
                [/message]

                [remove_shroud]
                    side=1
                    x= 2, 2
                    y=32,31
                [/remove_shroud]

                [terrain]
                    x,y=2,32
                    terrain=Qxu^Bs|
                [/terrain]

                [terrain]
                    x,y=2,29
                    terrain=Qxu^Bs|
                [/terrain]

                [redraw]
                [/redraw]

                [sound]
                    name=explosion.ogg
                [/sound]

                [set_variable]
                    name=Sewer_level_1.bridge_lowered
                    add=2
                [/set_variable]

                [message]
                    speaker=narrator
                    message= _ "Turning around to investigate, you discover that a stone bridge has appeared across the chasm. Was it some secret mechanism built into the statue that caused the sudden change in the landscape? Or was it magic? Or maybe the bridge is simply an illusion, meant to send the unwary plummeting to their deaths in the untold depths below?"
                [/message]

                [message]
                    speaker=narrator
                    message= _ "There's only one way to find out."
                [/message]
            [/else]
        [/if]
    [/event]

    #Event for getting the key

    [event]
        name=moveto

        [filter]
            id=$player.id
            [filter_location]
                x,y=6,24
            [/filter_location]
        [/filter]

        [if]
            [variable]
                name=Sewer_level_1.has_key_1
                numerical_equals=2
            [/variable]
            [then]
            [/then]
            [else]
                [set_variable]
                    name=Sewer_level_1.has_key_1
                    add=2
                [/set_variable]

                [message]
                    speaker=$player.id
                    message= _ "Hmm, a key. I wonder if..."
                [/message]

                [remove_item]
                    x,y=6,24
                    image=items/key.png
                [/remove_item]

                [unit]
                    type=Hulking Undead
                    id=Hulking Undead
                    name= _ "Hulking Undead"
                    side=2
                    x,y=6,24
                [/unit]

                [message]
                    speaker=Hulking Undead
                    message= _ "No! No take my shiny! Shiny is MINE!"
                [/message]

                [message]
                    speaker=$player.id
                    message= _ "Uh-oh!"
                [/message]
            [/else]
        [/if]
    [/event]

    #Now for the event that fires when you move to the locked gate
    [event]
        name=moveto
        first_time_only=no

        [filter]
            id=$player.id
            [filter_location]
                x,y=27,36
            [/filter_location]
        [/filter]

        [if]
            [variable]
                name=Sewer_level_1.gate_unlocked
                numerical_equals=2
            [/variable]

            [then]
            [/then]

            [else]
                [if]
                    [variable]
                        name=Sewer_level_1.has_key_1
                        numerical_equals=2
                    [/variable]

                    [then]
                        [sound]
                            name=gate.ogg
                        [/sound]

                        [remove_item]
                            x,y=28,35
                            image=scenery/gate-rusty-sw.png
                        [/remove_item]

                        [terrain]
                            x,y=28,35
                            terrain=Rb
                        [/terrain]

                        [message]
                            speaker=narrator
                            message= _ "One of your keys unlocks the gate."
                        [/message]

                        [set_variable]
                            name=Sewer_level_1.gate_unlocked
                            add=2
                        [/set_variable]
                    [/then]
                    [else]
                        [message]
                            speaker=$player.id
                            message= _ "Hmm, I can't get through this gate; it's locked. Maybe I can find a key around here somewhere..."
                        [/message]
                    [/else]
                [/if]
            [/else]
        [/if]
    [/event]

    #Stupid argues with saurian kids

    [event]
        name=moveto

        [filter]
            id=$player.id
            [filter_location]
                #x=53,52,53,54,54,53,52,51,52,53,54,55,55,54,53,52,51,50,51,52,53,54,55,56,#55,53,54,51
                #y=9,9,10,9,10,11,10,11,11,12,11,11,12,12,13,12,12,12,13,13,14,14,14,14,15,#15,14,14
                x,y=53,12
                radius=1
            [/filter_location]
        [/filter]

        [if]
            [variable]
                name=Sewer_level_1.found_saurians
                numerical_equals=2
            [/variable]
            [then]
            [/then]
            [else]
                [message]
                    speaker=$player.id
                    message= _ "I could swear I see something moving under this trash..."
                [/message]

                [store_unit]
                    variable=stupid_store
                    kill=no
                    [filter]
                        id=$player.id
                    [/filter]
                [/store_unit]

                [unit]
                    side=3
                    id=Saurian Child
                    type=Saurian Child
                    x=$stupid_store.x
                    y=$stupid_store.y
                [/unit]
                [unit]
                    side=3
                    type=Saurian Child
                    x=$stupid_store.x
                    y=$stupid_store.y
                [/unit]
                [unit]
                    side=3
                    type=Saurian Child
                    x=$stupid_store.x
                    y=$stupid_store.y
                [/unit]
                [unit]
                    side=3
                    type=Saurian Child
                    x=$stupid_store.x
                    y=$stupid_store.y
                [/unit]
                [unit]
                    side=3
                    type=Saurian Child
                    x=$stupid_store.x
                    y=$stupid_store.y
                [/unit]

                [set_variable]
                    name=Sewer_level_1.found_saurians
                    add=2
                [/set_variable]

                [message]
                    speaker=Saurian Child
                    message= _ "Haha! We have you surrounded, human!"
                [/message]

                [message]
                    speaker=$player.id
                    message= _ "Barely-hatched saurians? Ha, this should be easy. Unless, of course..."
                [/message]

                [unit]
                    id=Birakazz
                    name= _ "Birakazz"
                    type=Saurian Skirmisher
                    side=3
                    x,y=$stupid_store.x,$stupid_store.y
                [/unit]

                [message]
                    speaker=$player.id
                    message= _ "...the parent shows up."
                [/message]

                [message]
                    speaker=Birakazz
                    message= _ "Hssss!"
                [/message]

                {CLEAR_VARIABLE stupid_store}
            [/else]
        [/if]
    [/event]

    #When Birakazz dies, he gives the player the key to the island
    [event]
        name=die
        [filter]
            id=Birakazz
        [/filter]

        [message]
            speaker=narrator
            message= _ "You deal the adult lizard the fatal blow. As the creature falls to the ground, you notice a glint of metal around its throat. Examining the body, you find a silver key on a chain around its neck. You take it."
        [/message]

        [set_variable]
            name=Sewer_level_1.has_key_2
            add=2
        [/set_variable]
    [/event]

    #unlocking the second gate (or not)

    [event]
        name=moveto
        first_time_only=no

        [filter]
            id=$player.id
            [filter_location]
                x,y=31,21
            [/filter_location]
        [/filter]

        [if]
            [variable]
                name=Sewer_level_1.second_gate_unlocked
                numerical_equals=2
            [/variable]

            [then]
            [/then]

            [else]
                [if]
                    [variable]
                        name=Sewer_level_1.has_key_2
                        numerical_equals=2
                    [/variable]
                    [then]
                        [sound]
                            name=gate.ogg
                        [/sound]

                        [terrain]
                            x,y=30,20
                            terrain=Rb
                        [/terrain]

                        [remove_item]
                            x,y=30,20
                        [/remove_item]

                        [message]
                            speaker=narrator
                            message= _ "One of your keys unlocks the gate."
                        [/message]

                        [set_variable]
                            name=Sewer_level_1.second_gate_unlocked
                            add=2
                        [/set_variable]
                    [/then]
                    [else]
                        [message]
                            speaker=$player.id
                            message= _ "Hmm, I don't have the key to this gate. There must be some way to open it, though... I guess I'll just have to explore some more until I find something."
                        [/message]
                    [/else]
                [/if]
            [/else]
        [/if]
    [/event]

    #Going back up to Weldyn
    [event]
        name=moveto
        first_time_only=no

        [filter]
            id=$player.id
            [filter_location]
                x,y=2,39
            [/filter_location]
        [/filter]

        [message]
            speaker=narrator
            message= _ "Do you want to go back up to Weldyn?"

            [option]
                message = _ "Yes."
                [command]
                    [store_shroud]
                        side=1
                        variable=Sewer_level_1.shroud_data
                    [/store_shroud]

                    [store_unit]
                        [filter]
                            [filter_location]
                                x,y=2,39
                            [/filter_location]
                        [/filter]
                        variable=player_interlevel
                        kill=no
                    [/store_unit]

                    [if]
                        [variable]
                            name=Sewer_level_1.visited
                            numerical_equals=1
                        [/variable]
                        [then]
                        [/then]
                        [else]
                            [set_variable]
                                name=visited
                                add=1
                            [/set_variable]
                        [/else]
                    [/if]

                    [endlevel]
                        result=victory
                        next_scenario=Weldyn_2
                        carryover_report=no
                        linger_mode=no
                        save=no
                        carryover_percentage=100
                    [/endlevel]
                [/command]
            [/option]

            [option]
                message = _ "No."
                [command]
                [/command]
            [/option]

            image=wesnoth-icon.png
        [/message]
    [/event]

    #Moving from the island trapdoor to the NW room that goes to the next level
    [event]
        name=moveto
        first_time_only=no
        [filter]
            id=$player.id
            [filter_location]
                x,y=33,18
            [/filter_location]
        [/filter]

        [remove_item]
            x,y=33,18
        [/remove_item]

        {PLACE_IMAGE "scenery/trapdoor-open.png" 33 18}

        [if]
            [variable]
                name=trapdoor
                numerical_equals=2
            [/variable]
            [then]
                [teleport]
                    [filter]
                        x,y=$x1,$y1
                    [/filter]
                    x,y=6,1
                [/teleport]

                {SCROLL_TO 6 1}
            [/then]

            [else]
                [sound]
                    name=open-chest.wav
                [/sound]

                [set_variable]
                    name=trapdoor
                    add=2
                [/set_variable]

                [teleport]
                    [filter]
                        x,y=$x1,$y1
                    [/filter]
                    x,y=6,1
                [/teleport]

                {SCROLL_TO 6 1}
            [/else]
        [/if]
    [/event]

    [event]
        name=moveto
        first_time_only=no
        [filter]
            id=$player.id
            [filter_location]
                x,y=6,1
            [/filter_location]
        [/filter]

        [teleport]
            [filter]
                x,y=$x1,$y1
            [/filter]
            x,y=33,18
        [/teleport]

        {SCROLL_TO 33 18}
    [/event]

    #############The nw hall##########

    #moving in front of the gate

    [event]
        name=moveto

        [filter]
            id=$player.id
            [filter_location]
                x,y=6,3
            [/filter_location]
        [/filter]

        [message]
            speaker=$player.id
            message= _"Drat, another locked gate. There must be some way to open it... or perhaps there's a way around it?"
        [/message]
    [/event]

    #Exiting the level via the trapdoor in the nw hall

    [event]
        name=moveto
        first_time_only=no

        [filter]
            id=$player.id
            [filter_location]
                x,y=17,6
            [/filter_location]
        [/filter]

        [set_variable]
            name=Sewer_level_1.found_exit
            add=2
        [/set_variable]

        [message]
            speaker=narrator
            message= _ "Do you want to go deeper into the sewers?"

            [option]
                message = _ "Yes."
                [command]
                    [store_shroud]
                        side=1
                        variable=Sewer_level_1.shroud_data
                    [/store_shroud]

                    [store_unit]
                        [filter]
                            [filter_location]
                                x,y=17,6
                            [/filter_location]
                        [/filter]
                        variable=player_interlevel
                        kill=no
                    [/store_unit]

                    [endlevel]
                        result=victory
                        next_scenario=Sewer_Level_2
                        carryover_report=no
                        linger_mode=no
                        save=no
                    [/endlevel]
                [/command]
            [/option]

            [option]
                message = _ "No."
                [command]
                [/command]
            [/option]

            image=wesnoth-icon.png
        [/message]
    [/event]

    [event]
        name=die
        [filter]
            id=zombie9
        [/filter]
        [set_variable]
            name=zombie9_dead
            add=2
        [/set_variable]
    [/event]

    [event]
        name=die
        [filter]
            id=zombie10
        [/filter]
        [set_variable]
            name=zombie10_dead
            add=2
        [/set_variable]
    [/event]

    [event]
        name=die
        [filter]
            id=zombie11
        [/filter]
        [set_variable]
            name=zombie11_dead
            add=2
        [/set_variable]
    [/event]

    [event]
        name=die
        [filter]
            id=soulless3
        [/filter]
        [set_variable]
            name=soulless3_dead
            add=2
        [/set_variable]
    [/event]

    [event]
        name=die
        [filter]
            id=soulless4
        [/filter]
        [set_variable]
            name=soulless4_dead
            add=2
        [/set_variable]
    [/event]
[/scenario]
