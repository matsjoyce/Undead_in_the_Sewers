#textdomain wesnoth-Undead_in_the_Sewers

#define MENU_ITEMS
    {INVENTORY}
    {CHARACTER}
    {HELP}
    {ADVANCEMENT}
#enddef

#this function used for all 'useable' items
#define ITEM_USE ID
    [option]
        [show_if]
            [variable]
                name=player.variables.inventory.{ID}
                greater_than=0
            [/variable]
        [/show_if]
        message=_ {MENU_IMG_TXT "$items.{ID}.icon" "<span color='#BCB088' size='large' weight='bold' >$items.{ID}.name</span>
<span color='#009418' size='small' >$items.{ID}.description</span>
(Have: $player.variables.inventory.{ID})"}
        [command]
            [message]
                speaker=narrator
                caption=$items.{ID}.name
                message= _ "$items.{ID}.inspect_message

<span color='#BCB088' >Weight:</span> $items.{ID}.weight
<span color='#BCB088' >Value:</span> $items.{ID}.sell_price
<span color='#BCB088' >Have:</span> $player.variables.inventory.{ID}"
                [option]
                    message= _ {MENU_IMG_TXT "misc/action.png" "<span color='#BCB088' size='large'>Use Item</span>"}
                [insert_tag]
                    name=command
                    variable=items.{ID}.use_actions
                [/insert_tag]
            [/option]
            [option]
                message= _ {MENU_IMG_TXT "misc/drop.png" "<span color='#BCB088' size='large'>Drop Item</span>"}
                [command]
                    [message]
                        speaker=narrator
                        caption=$items.{ID}.name
                        image=$items.{ID}.icon
                        message= _ "Are you sure you want to do this? Once dropped the item will be lost forever!"
                        [option]
                            message= _ {MENU_IMG_TXT "misc/check.png" "<span color='#BCB088' size='large'>Drop</span>"}
                            [command]
                                [if]                 
                                    [variable]
                                        name=player.variables.inventory.{ID}
                                        greater_than=1
                                    [/variable]
                                    [then]


                                        [message]
                                            speaker=narrator
                                            caption=$items.{ID}.name
                                            image=$items.{ID}.icon
                                            message= _ "How many do you want to drop?"
                                            [text_input]
                                                variable=drop_amount
                                                label="<span color='#BCB088' >Amount: </span>"
                                                max_length="20"
                                            [/text_input]
                                        [/message]
                                        [if]
                                        [variable]
                                            name=drop_amount
                                            greater_than=$player.variables.inventory.{ID}
                                        [/variable]
                                            [then]

                                                [set_variable]
                                                    name=player.variables.inventory.{ID}
                                                    value=$drop_amount
                                                [/set_variable]
                                                [set_variable]
                                                    name=player.variables.inventory.{ID}
                                                    sub=$drop_amount
                                                [/set_variable]


                                                [set_variable]
                                                    name=weight_lost
                                                    value=$drop_amount
                                                [/set_variable]


#{DEBUG_MSG "Pre-function: weight lost is now: $weight_lost"}


                                                {VARIABLE_OP weight_lost multiply $items.{ID}.weight}

#debug message
#                                               [message]
#                                                   speaker=narrator
#                                                   message= _ "Post-function: weight lost is now: $weight_lost"
#                                               [/message]

                                                [item]
                                                    x=$x1
                                                    y=$y1
                                                    image=$items.{ID}.ground_icon
                                                    visible_in_fog=no
                                                [/item]

                                                [set_variable]
                                                    name=player.variables.carrying_pounds
                                                    sub=$weight_lost
                                                [/set_variable]

                                                {CLEAR_VARIABLE weight_lost}


                                            [/then]
                                            [else]

                                                [set_variable]
                                                    name=player.variables.inventory.{ID}
                                                    sub=$drop_amount
                                                [/set_variable]
                                                [set_variable]
                                                    name=weight_lost
                                                    value=$drop_amount
                                                [/set_variable]

#debug message
#                                               [message]
#                                                   speaker=narrator
#                                                   message= _ "Pre-function: weight lost is now: $weight_lost"
#                                               [/message]

                                                {VARIABLE_OP weight_lost multiply $items.{ID}.weight}

#debug message
#                                               [message]
#                                                   speaker=narrator
#                                                   message= _ "Post-function: weight lost is now: $weight_lost"
#                                               [/message]

                                                [set_variable]
                                                    name=player.variables.carrying_pounds
                                                    sub=$weight_lost
                                                [/set_variable]
                                                {CLEAR_VARIABLE weight_lost}

                                                [item]
                                                    x=$x1
                                                    y=$y1
                                                    image=$items.{ID}.ground_icon
                                                    visible_in_fog=no
                                                [/item]
                                            [/else]
                                        [/if]
                                    [/then]
                                    [else]
#debug message
#                                       [message]
#                                           speaker=narrator
#                                           message= _ "The weight of the item to be dropped is: $items.{ID}.weight pounds. You are currently carrying $player.variables.carrying_weight. pounds."
#                                       [/message]

                                        [item]
                                            x=$x1
                                            y=$y1
                                            image=$items.{ID}.ground_icon
                                            visible_in_fog=no
                                        [/item]

                                        [set_variable]
                                            name=player.variables.inventory.{ID}
                                            add=-1
                                        [/set_variable]
                                        [set_variable]
                                            name=player.variables.carrying_pounds
                                            sub=$items.{ID}.weight
                                        [/set_variable]
#debug message
#                                       [message]
#                                           speaker=narrator
#                                           message= _ "Item dropped. Now carrying: $player.variables.carrying_pounds pounds."
#                                       [/message]  
                                    [/else]
                                    [/if]
                                [/command]
                            [/option]
                            [option]
                                message= _ {MENU_IMG_TXT "misc/x.png" "<span color='#BCB088' >Cancel</span>"}
                                [command]
                                [/command]
                            [/option]
                       [/message]
                  [/command]
              [/option]
              [option]
                  message= _ {MENU_IMG_TXT "misc/back.png" "<span color='#BCB088' size='large'>Back</span>"}
                  [command]
                      [sound]
                          name=UI/menu_launch.ogg
                      [/sound]
                  [/command]
              [/option]
         [/message]
     [/command]
[/option]
#enddef


#this function used for all 'equippable' items
#define ITEM_EQUIP ID
[option]
    [show_if]
        [variable]
            name=player.variables.inventory.{ID}
            greater_than=0
        [/variable]
    [/show_if]
    message=_ {MENU_IMG_TXT "$items.{ID}.icon" "<span color='#BCB088' size='large' weight='bold' >$items.{ID}.name</span>
<span color='#009418' size='small' >$items.{ID}.description</span>
<span color='#a30000' size='small'>$items.{ID}.required_description</span>
(Have: $player.variables.inventory.{ID})"}
    [command]
        [message]
            speaker=narrator
            caption=$items.{ID}.name
            image=$items.{ID}.icon
            message= _ "$items.{ID}.inspect_message

        <span color='#BCB088' >Weight:</span> $items.{ID}.weight
        <span color='#BCB088' >Value:</span> $items.{ID}.sell_price
        <span color='#BCB088' >Have:</span> $player.variables.inventory.{ID}"
        [option]
            message= _ {MENU_IMG_TXT "misc/action.png" "<span color='#BCB088' size='large'>Equip Item</span>"}
                [command]
                    [if]
                        [variable]
                            name=player.variables.equipped.$items.{ID}.slot|
                            not_equals=empty
                        [/variable]
                        [then]
                        [message]
                        speaker=narrator
                        message= _ "You already have an item in the $items.{ID}.slot equipment slot! You must remove the existing item from the slot in order to equip another item in that slot."
                        [/message]
                        [/then]
                        [else]
[if]
[variable]
name=player.variables.skills.$items.{ID}.equip_required_skill
greater_than_equal_to=$items.{ID}.equip_required_skill_level
[/variable]
[then]
                            [insert_tag]
                                name=object
                                variable=items.{ID}.object
                            [/insert_tag]
                            [set_variable]
                                name=player.variables.inventory.{ID}
                                add=-1
                            [/set_variable]
                            [set_variable]
                                name=player.variables.equipped.$items.{ID}.slot|
                                value={ID}
                            [/set_variable]
                            [sound]
                                name=$items.{ID}.sound
                            [/sound]
                            [message]
                                speaker=narrator
                                image=$items.{ID}.icon
                                message= _ "You equip $items.{ID}.indefinite_article $items.{ID}.context_name in the $items.{ID}.slot slot."
                        [/message]
[/then]
[else]
                            [message]
                                speaker=narrator
                                image=$items.{ID}.icon
                                message= _ "Cannot equip item! A minimum of $items.{ID}.equip_required_skill_level levels of $items.{ID}.equip_required_skill is required in order to equip this item, you currently only have $player.variables.skills.$items.{ID}.equip_required_skill levels of $items.{ID}.equip_required_skill."
                        [/message]
[/else]
[/if]
                        [/else]
                    [/if]
                [/command]
            [/option]
            [option]
                message= _ {MENU_IMG_TXT "misc/drop.png" "<span color='#BCB088' size='large'>Drop Item</span>"}
                [command]
                    [message]
                        speaker=narrator
                        caption=$items.{ID}.name
                        image=$items.{ID}.icon
                        message= _ "Are you sure you want to do this? Once dropped the item will be lost forever!"
                        [option]
                            message= _ {MENU_IMG_TXT "misc/check.png" "<span color='#BCB088' size='large'>Drop</span>"}
                            [command]
                                [if]                 
                                    [variable]
                                        name=player.variables.inventory.{ID}
                                        greater_than=1
                                    [/variable]
                                    [then]


                                        [message]
                                            speaker=narrator
                                            caption=$items.{ID}.name
                                            image=$items.{ID}.icon
                                            message= _ "How many do you want to drop?"
                                            [text_input]
                                                variable=drop_amount
                                                label="<span color='#BCB088' >Amount: </span>"
                                                max_length="20"
                                            [/text_input]
                                        [/message]
                                        [if]
                                        [variable]
                                            name=drop_amount
                                            greater_than=$player.variables.inventory.{ID}
                                        [/variable]
                                            [then]

                                                [set_variable]
                                                    name=player.variables.inventory.{ID}
                                                    value=$drop_amount
                                                [/set_variable]
                                                [set_variable]
                                                    name=player.variables.inventory.{ID}
                                                    sub=$drop_amount
                                                [/set_variable]


                                                [set_variable]
                                                    name=weight_lost
                                                    value=$drop_amount
                                                [/set_variable]


#{DEBUG_MSG "Pre-function: weight lost is now: $weight_lost"}


                                                {VARIABLE_OP weight_lost multiply $items.{ID}.weight}

#debug message
#                                               [message]
#                                                   speaker=narrator
#                                                   message= _ "Post-function: weight lost is now: $weight_lost"
#                                               [/message]

                                                [item]
                                                    x=$x1
                                                    y=$y1
                                                    image=$items.{ID}.ground_icon
                                                    visible_in_fog=no
                                                [/item]

                                                [set_variable]
                                                    name=player.variables.carrying_pounds
                                                    sub=$weight_lost
                                                [/set_variable]

                                                {CLEAR_VARIABLE weight_lost}


                                            [/then]
                                            [else]

                                                [set_variable]
                                                    name=player.variables.inventory.{ID}
                                                    sub=$drop_amount
                                                [/set_variable]
                                                [set_variable]
                                                    name=weight_lost
                                                    value=$drop_amount
                                                [/set_variable]

#debug message
#                                               [message]
#                                                   speaker=narrator
#                                                   message= _ "Pre-function: weight lost is now: $weight_lost"
#                                               [/message]

                                                {VARIABLE_OP weight_lost multiply $items.{ID}.weight}

#debug message
#                                               [message]
#                                                   speaker=narrator
#                                                   message= _ "Post-function: weight lost is now: $weight_lost"
#                                               [/message]

                                                [set_variable]
                                                    name=player.variables.carrying_pounds
                                                    sub=$weight_lost
                                                [/set_variable]
                                                {CLEAR_VARIABLE weight_lost}

                                                [item]
                                                    x=$x1
                                                    y=$y1
                                                    image=$items.{ID}.ground_icon
                                                    visible_in_fog=no
                                                [/item]
                                            [/else]
                                        [/if]
                                    [/then]
                                    [else]
#debug message
#                                       [message]
#                                           speaker=narrator
#                                           message= _ "The weight of the item to be dropped is: $items.{ID}.weight pounds. You are currently carrying $player.variables.carrying_weight. pounds."
#                                       [/message]

                                        [item]
                                            x=$x1
                                            y=$y1
                                            image=$items.{ID}.ground_icon
                                            visible_in_fog=no
                                        [/item]

                                        [set_variable]
                                            name=player.variables.inventory.{ID}
                                            add=-1
                                        [/set_variable]
                                        [set_variable]
                                            name=player.variables.carrying_pounds
                                            sub=$items.{ID}.weight
                                        [/set_variable]
#debug message
#                                       [message]
#                                           speaker=narrator
#                                           message= _ "Item dropped. Now carrying: $player.variables.carrying_pounds pounds."
#                                       [/message]  
                                    [/else]
                                    [/if]
                                [/command]
                            [/option]
                            [option]
                                message= _ {MENU_IMG_TXT "misc/x.png" "<span color='#BCB088' >Cancel</span>"}
                                [command]
                                [/command]
                            [/option]
                       [/message]
                  [/command]
              [/option]
              [option]
                  message= _ {MENU_IMG_TXT "misc/back.png" "<span color='#BCB088' size='large'>Back</span>"}
                  [command]
                      [sound]
                          name=UI/menu_launch.ogg
                      [/sound]
                  [/command]
              [/option]
         [/message]
     [/command]
[/option]
#enddef

#this function used for all static items (i.e., items that cannot be equipped or used) that do not affect the player in any way
#define ITEM_STATIC_NONFUNCTIONAL ID
[option]
    [show_if]
        [variable]
            name=player.variables.inventory.{ID}
            greater_than=0
        [/variable]
    [/show_if]
    message=_ {MENU_IMG_TXT "$items.{ID}.icon" "<span color='#BCB088' size='large' weight='bold' >$items.{ID}.name</span>
(Have: $player.variables.inventory.{ID})"}
    [command]
        [message]
            speaker=narrator
            caption=$items.{ID}.name
            image=$items.{ID}.icon
            message= _ "$items.{ID}.inspect_message

        <span color='#BCB088' >Weight:</span> $items.{ID}.weight
        <span color='#BCB088' >Value:</span> $items.{ID}.sell_price
        <span color='#BCB088' >Have:</span> $player.variables.inventory.{ID}"
            [option]
                message= _ {MENU_IMG_TXT "misc/drop.png" "<span color='#BCB088' size='large'>Drop Item</span>"}
                [command]
                    [message]
                        speaker=narrator
                        caption=$items.{ID}.name
                        image=$items.{ID}.icon
                        message= _ "Are you sure you want to do this? Once dropped the item will be lost forever!"
                        [option]
                            message= _ {MENU_IMG_TXT "misc/check.png" "<span color='#BCB088' size='large'>Drop</span>"}
                            [command]
                                [if]                 
                                    [variable]
                                        name=player.variables.inventory.{ID}
                                        greater_than=1
                                    [/variable]
                                    [then]


                                        [message]
                                            speaker=narrator
                                            caption=$items.{ID}.name
                                            image=$items.{ID}.icon
                                            message= _ "How many do you want to drop?"
                                            [text_input]
                                                variable=drop_amount
                                                label="<span color='#BCB088' >Amount: </span>"
                                                max_length="20"
                                            [/text_input]
                                        [/message]
                                        [if]
                                        [variable]
                                            name=drop_amount
                                            greater_than=$player.variables.inventory.{ID}
                                        [/variable]
                                            [then]

                                                [set_variable]
                                                    name=player.variables.inventory.{ID}
                                                    value=$drop_amount
                                                [/set_variable]
                                                [set_variable]
                                                    name=player.variables.inventory.{ID}
                                                    sub=$drop_amount
                                                [/set_variable]


                                                [set_variable]
                                                    name=weight_lost
                                                    value=$drop_amount
                                                [/set_variable]


#{DEBUG_MSG "Pre-function: weight lost is now: $weight_lost"}


                                                {VARIABLE_OP weight_lost multiply $items.{ID}.weight}

#debug message
#                                               [message]
#                                                   speaker=narrator
#                                                   message= _ "Post-function: weight lost is now: $weight_lost"
#                                               [/message]

                                                [item]
                                                    x=$x1
                                                    y=$y1
                                                    image=$items.{ID}.ground_icon
                                                    visible_in_fog=no
                                                [/item]

                                                [set_variable]
                                                    name=player.variables.carrying_pounds
                                                    sub=$weight_lost
                                                [/set_variable]

                                                {CLEAR_VARIABLE weight_lost}


                                            [/then]
                                            [else]

                                                [set_variable]
                                                    name=player.variables.inventory.{ID}
                                                    sub=$drop_amount
                                                [/set_variable]
                                                [set_variable]
                                                    name=weight_lost
                                                    value=$drop_amount
                                                [/set_variable]

#debug message
#                                               [message]
#                                                   speaker=narrator
#                                                   message= _ "Pre-function: weight lost is now: $weight_lost"
#                                               [/message]

                                                {VARIABLE_OP weight_lost multiply $items.{ID}.weight}

#debug message
#                                               [message]
#                                                   speaker=narrator
#                                                   message= _ "Post-function: weight lost is now: $weight_lost"
#                                               [/message]

                                                [set_variable]
                                                    name=player.variables.carrying_pounds
                                                    sub=$weight_lost
                                                [/set_variable]
                                                {CLEAR_VARIABLE weight_lost}

                                                [item]
                                                    x=$x1
                                                    y=$y1
                                                    image=$items.{ID}.ground_icon
                                                    visible_in_fog=no
                                                [/item]
                                            [/else]
                                        [/if]
                                    [/then]
                                    [else]
#debug message
#                                       [message]
#                                           speaker=narrator
#                                           message= _ "The weight of the item to be dropped is: $items.{ID}.weight pounds. You are currently carrying $player.variables.carrying_weight. pounds."
#                                       [/message]

                                        [item]
                                            x=$x1
                                            y=$y1
                                            image=$items.{ID}.ground_icon
                                            visible_in_fog=no
                                        [/item]

                                        [set_variable]
                                            name=player.variables.inventory.{ID}
                                            add=-1
                                        [/set_variable]
                                        [set_variable]
                                            name=player.variables.carrying_pounds
                                            sub=$items.{ID}.weight
                                        [/set_variable]
#debug message
#                                       [message]
#                                           speaker=narrator
#                                           message= _ "Item dropped. Now carrying: $player.variables.carrying_pounds pounds."
#                                       [/message]  
                                    [/else]
                                    [/if]
                                [/command]
                            [/option]
                            [option]
                                message= _ {MENU_IMG_TXT "misc/x.png" "<span color='#BCB088' >Cancel</span>"}
                                [command]
                                [/command]
                            [/option]
                       [/message]
                  [/command]
              [/option]
              [option]
                  message= _ {MENU_IMG_TXT "misc/back.png" "<span color='#BCB088' size='large'>Back</span>"}
                  [command]
                      [sound]
                          name=UI/menu_launch.ogg
                      [/sound]
                  [/command]
              [/option]
         [/message]
     [/command]
[/option]
#enddef


#define INVENTORY
[set_menu_item]
    id=1inventory
    description="Inventory"
    image=misc/backpack.png
    [show_if]
        [have_unit]
            id=$player.id
            x,y=$x1,$y1
        [/have_unit]
    [/show_if]
    [command]
        [sound]
            name=UI/menu_launch.ogg
        [/sound]
        {VARIABLE finished no}
        [redraw]
        [/redraw]
        [while]
            [variable]
                name=finished
                equals=no
            [/variable]
            [do]
                [message]
                    speaker=narrator
                    caption=Inventory
                    message="Carrying $player.variables.carrying_pounds/$player.variables.max_carry_pounds pounds"

#potions
                   {ITEM_USE "curing_potion"}
                   {ITEM_USE "health_potion"}
                   {ITEM_USE "movement_potion"}

#helmets
                   {ITEM_EQUIP "dented_helm"}
                   {ITEM_EQUIP "shining_helm"}
                   {ITEM_EQUIP "bascinet"}

#armor
                   {ITEM_EQUIP "leather_armor"}
                   {ITEM_EQUIP "chainmail_tunic"}
                   {ITEM_EQUIP "burnished_breastplate"}
                   {ITEM_EQUIP "steel_breastplate"}

#weapons
                   {ITEM_EQUIP "short_sword"}
                   {ITEM_EQUIP "bastard_sword"}
                   {ITEM_EQUIP "longsword"}
                   {ITEM_EQUIP "greatsword"}
                   {ITEM_EQUIP "broadsword"}

#ranged weapons
                   {ITEM_EQUIP "shortbow"}
                   {ITEM_EQUIP "yew_bow"}
                   {ITEM_EQUIP "compound_bow"}
                   {ITEM_EQUIP "longbow"}

#non-functional items
                   {ITEM_STATIC_NONFUNCTIONAL "skull"}
                   {ITEM_STATIC_NONFUNCTIONAL "saw"}


                   [option]
                       image=misc/check.png
                       message=_ {MENU_IMG_TXT "misc/check.png" "<span color='#BCB088' font_size='large'>Done</span>"}
                       [command]
                           [sound]
                               name=UI/menu_launch.ogg
                           [/sound]
                           {VARIABLE finished yes}
                       [/command]
                   [/option]
               [/message]
               [redraw]
               [/redraw]
            [/do]
        [/while]
        {CLEAR_VARIABLE finished}
    [/command]
[/set_menu_item]
#enddef


#define HELP
        [set_menu_item]
            id=4help
            description="Help"
            image=misc/book1.png
            [show_if]
                [have_unit]
                    side=1
                    canrecruit=yes
                    x,y=$x1,$y1
                [/have_unit]
            [/show_if]
            [command]
                {VARIABLE finished no}
                [redraw]
                [/redraw]
                [while]
                    [variable]
                        name=finished
                        equals=no
                    [/variable]
                    [do]
                        [message]
                            speaker=narrator
                            message="Select a topic below"
                            [option]
                                image=misc/book5-small.png
                                message="Inventory"
                                [command]
                                    [message]
                                        speaker=narrator
                                        caption=Inventory
                                        image=wesnoth-icon.png
                                        message=_ "To access the inventory, simply right-click (command+click for some Mac users) on your character, and chose the 'Inventory' option from the list of commands that appears.
    Once you select the 'Inventory' option, you will be taken to your inventory screen. Here you can see all the items currently in your inventory. There is no maximum number of items you may have in your inventory; however, you may never carry more items in your inventory than your strength permits. At the top of the inventory dialogue you will see the words "Carrying (some number) / (another number) pounds". The first number shows how many pounds you are currently carrying, and the second number shows the maximum weight of items you can carry at one time. You can increase your maximum carrying weight by increasing your strength when you level up. When you add an item to your inventory, the item's weight is added to how many pounds you are currently carrying, and when you remove an item from your inventory (by either using or selling it), the weight of the item used or sold is removed from how many pounds you are currently carrying.
    If you use an item, it will disappear from your inventory for good. If have several of the same kind of item and you use one (i.e., you have three healing potions and you use one), only the item that you used will disappear (so now you will have two healing potions instead of three). Items that you can have more than one of at once are classified as <i>cumulative</i> items. However, this may change in future versions.
    Some items are classified as <i>non-cumulative</i>, that is, there is only one of that item in the game. For instance, there is only one suit of Vulcanite armor in the game, so this item is classified as non-cumulative.
    The third classification of items in the game is <i>special</i> items. This classification is given to items that do not affect your character directly, such as keys or quest objects (i.e., a scroll given to you to deliver to a certain person). There is an option in your inventory that allows you to access a list of all special items currently in your possession, but you cannot interact directly with the items in this list (i.e., you cannot click on them or apply them directly to your character)."
                                    [/message]
                                [/command]
                            [/option]
                            [option]
							image=misc/book5-small.png
							message="Glossary of Terms"
								[command]
									[message]
									speaker=narrator
									caption=Glossary of Terms
									message=_ "
    -PC
    Playable Character, refers to the character you control throughout the game.
    -NPC
    Non Playable Character, refers to any character you cannot control but can interact with through the PC.
    -UitS
    Acronym for Undead in the Sewers!, the title of this campaign.
    -AMLA
    Wesnoth acronym for After Maximum Level Advancement. In this campaign, it means your advancement tree.
    -Cumulative Items
    Items that you can have more than one of in your inventory simultaneously, such as health potions.
    -Non-Cumulative Items
    Items that you cannot have more than one of at the same time, or items that there are only one of in the entire game. Vulcanite armor is an example of a non-cumulative item.
    -Special Items
    Items that you cannot interact with directly, but affect your surroundings and dialogue choices. Some examples of special items are keys and quest items (such as a scroll given to you by one NPC to deliver to another NPC)."
									image=wesnoth-icon.png
									[/message]
								[/command]
							[/option]
							[option]
							message="Summoning"
							image="attacks/ink.png"
								[command]
									[message]
									speaker=narrator
									caption=Summoning
									message=_ "	To summon creatures to aid you in your adventures, right-click on your character and choose the 'Summon' option from the menu that appears. You will then be allowed to choose what kind of creature you want to summon.
    The type of creature you can summon depends on your level of skill in the summoning spell. You may have a maximum of two summoned creatures at any time, due to the amount of concentration needed to control the creatures. You can, however, summon another creature should one of the previously summoned creatures die.
    Summoning creatures costs you hitpoints. You can restore these lost hitpoints by remaining inactive for a number of turns (although this method takes a long time to fully heal you, as you only receive +2 hitpoints per turn) or by using a health potion or some other health-restorative medium."
									image=wesnoth-icon.png
									[/message]
								[/command]
							[/option]
							[option]
							message="Talking to NPC's"
							image="attacks/ink.png"
								[command]
									[message]
									speaker=narrator
									caption=Talking to NPC's
									message=_ "	To talk to an NPC, simply move to a hex adjacent to that NPC and click on him with the left mouse button. If the NPC is able to talk to you, a dialogue option will come up. If a dialogue option does not come up, that NPC cannot talk to you."
									image=wesnoth-icon.png
									[/message]
								[/command]
							[/option]
							[option]
							image=misc/book5-small.png
							message="Done"
								[command]
								{VARIABLE finished yes}
								[/command]
							[/option]
						[/message]
						[redraw]
						[/redraw]
					[/do]
				[/while]
			{CLEAR_VARIABLE finished}
			[/command]
		[/set_menu_item]
	#enddef
#Full credit for the summoning code goes to Captain_Wrathbow, who created  it for his add-on 'It's Good to be Evil'. I just modified it slightly to  fit my purposes (with his permission, of course).
#This goes in every scenario. Make sure it is placed within the start event.
	#define SUMMONING
		[set_menu_item]
		id=3summon
		description="Summon"
		image=misc/book2.png
			[show_if]
				[have_unit]
				id=$player.id
				x,y=$x1,$y1
				[/have_unit]
			[/show_if]
			[command]
				[store_unit]
					[filter]
					id=$player.id
					[/filter]
				variable=check_hp
				kill=no
				[/store_unit]
				[store_locations]
				#adjacent to side 1 leader
					[filter_adjacent_location]
						[filter]
						side=1
						canrecruit=yes
						[/filter]
					[/filter_adjacent_location]
				#not impassible
				terrain="!,Qxu,Ql,Qlf,Mm^Xm,Md^Xm,Xu,Xos,^Xo,Xv"
				#not occupied
					[not]
						[filter]
						[/filter]
					[/not]
				variable=summonhere
				[/store_locations]
				[message]
				speaker=narrator
				message=_ "Choose the type of minion you wish to summon."
					[option]
					message=_ {MENU_IMG_TXT "units/undead/bat-se-2.png" "Vampire Bat         8 HP"}
						[show_if]
							[variable]
							name=unitcount
							less_than=2
							[/variable]
						[/show_if]
						[command]
							[if]
								[variable]
								name=check_hp.hitpoints
								greater_than=8
								[/variable]
								[and]
									[variable]
									name=summonhere.x
									not_equals=""
									[/variable]
								[/and]
								[then]
									[object]
									silent=yes
										[filter]
										id=$player.id
										[/filter]
										[effect]
										apply_to=hitpoints
										increase=-8
										[/effect]
									[/object]
									[sound]
									name=summon.ogg
									[/sound]
									[sound]
									name=bat-flapping.wav
									[/sound]
									[set_variable]
									name=unitcount
									add=1
									[/set_variable]
									[unit]
									type=Vampire Bat
									side=1
									x=$summonhere.x
									y=$summonhere.y
									moves=0
									animate=yes
									[/unit]
								[/then]
								[else]
									[message]
									speaker=$player.id
									message=_ "I can't summon anymore right now..."
									[/message]
								[/else]
							[/if]
						[/command]
					[/option]
					[option]
					message=_ {MENU_IMG_TXT "units/monsters/giant-rat.png" "Giant Rat         5 HP"}
						[show_if]
							[variable]
							name=unitcount
							less_than=2
							[/variable]
						[/show_if]
						[command]
							[if]
								[variable]
								name=check_hp.hitpoints
								greater_than=5
								[/variable]
								[and]
									[variable]
									name=summonhere.x
									not_equals=""
									[/variable]
								[/and]
                        [then]
                            [object]
                                silent=yes
                                [filter]
                                    id=$player.id
                                [/filter]
                                [effect]
                                    apply_to=hitpoints
                                    increase=-5
                                [/effect]
                            [/object]
                            [sound]
                                name=summon.ogg
                            [/sound]
                            [sound]
                                name=bat-flapping.wav
                            [/sound]
                            [set_variable]
                                name=unitcount
                                add=1
                            [/set_variable]
                            [unit]
                                type=Giant Rat
                                side=1
                                x=$summonhere.x
                                y=$summonhere.y
                                moves=0
                                animate=yes
                            [/unit]
                        [/then]
                        [else]
                            [message]
                                speaker=$player.id
                                message=_ "I can't summon anymore right now..."
                            [/message]
                        [/else]
                    [/if]
                [/command]
            [/option]
            [option]
                message=_ {MENU_IMG_TXT "items/ball-magenta.png" "Summon nothing"}
                [command]
                [/command]
            [/option]
        [/message]
        [clear_variable]
            name=check_hp
        [/clear_variable]
    [/command]
[/set_menu_item]

[event]
    name=die
    first_time_only=no
    [filter]
        side=1
        [not]
            id=$player.id
        [/not]
    [/filter]
    [set_variable]
        name=unitcount
        add=-1
    [/set_variable]
[/event]
#enddef



#define CHARACTER_SLOT SLOT_ID SLOT_NAME
[option]
    [show_if]
        [variable]
            name=player.variables.equipped.{SLOT_ID}
            equals=empty
        [/variable]
    [/show_if]
    message= _ {MENU_IMG_TXT "attacks/blank-attack.png" "<span color='#BCB088' font_size='large'>{SLOT_NAME}</span>
<span color='#BCB088'>Equipped:</span> Empty"}
        [command]
        [/command]
    [/option]

    [option]
        [show_if]
            [variable]
                name=player.variables.equipped.{SLOT_ID}
                not_equals=empty
            [/variable]
        [/show_if]
        message= _ {MENU_IMG_TXT "$items.$player.variables.equipped.{SLOT_ID}|.icon" "<span color='#BCB088' font_size='large'>{SLOT_NAME}</span>
<span color='#BCB088' >Equipped:</span> $items.$player.variables.equipped.{SLOT_ID}|.name"}
        [command]
            [message]
                image=$items.$player.variables.equipped.{SLOT_ID}|.icon
                speaker=narrator
                caption=$items.$player.variables.equipped.{SLOT_ID}|.name
                message= _ "$items.$player.variables.equipped.{SLOT_ID}|.inspect_message

<span color='#BCB088' >Weight:</span> $items.$player.variables.equipped.{SLOT_ID}|.weight
<span color='#BCB088' >Value:</span> $items.$player.variables.equipped.{SLOT_ID}|.sell_price"
                [option]
                    message= _ {MENU_IMG_TXT "$items.$player.variables.equipped.{SLOT_ID}|.icon" "<span color='#BCB088' >Unequip item</span>"}
                [command]
                    [sound]
                        name=$items.$player.variables.equipped.{SLOT_ID}|.sound
                    [/sound]
                    [insert_tag]
                        name=object
                        variable=items.$player.variables.equipped.{SLOT_ID}|.counter_object
                    [/insert_tag]
                    [set_variable]
                        name=player.variables.inventory.$player.variables.equipped.{SLOT_ID}|
                        add=1
                    [/set_variable]
                    [set_variable]
                        name=player.variables.equipped.{SLOT_ID}
                        value=empty
                    [/set_variable]
                [/command]
            [/option]
            [option]
                message= _ {MENU_IMG_TXT "misc/back.png" "<span color='#BCB088' >Back</span>"}
                [command]
                    [sound]
                        name=UI/menu_launch.ogg
                    [/sound]
                [/command]
            [/option]
        [/message]
    [/command]
[/option]

#enddef


#define CHARACTER
[set_menu_item]
    id=2character
    description="Character"
    image=misc/character.png
    [show_if]
        [have_unit]
            id=$player.id
            x,y=$x1,$y1
        [/have_unit]
    [/show_if]
    [command]
        [sound]
            name=UI/menu_launch.ogg
        [/sound]
        {VARIABLE finished no}
        [redraw]
        [/redraw]
        [while]
            [variable]
                name=finished
                equals=no
            [/variable]
            [do]
                [message]
                    speaker=narrator
                    message= _ "<span color='#BCB088'>Carrying $player.variables.carrying_pounds/$player.variables.max_carry_pounds pounds</span>

        <span color='#BCB088'>Strength:</span>           $player.variables.skills.strength
        <span color='#BCB088'>Vitality:</span>           $player.variables.skills.vitality
        <span color='#BCB088'>Intelligence:</span>       $player.variables.skills.intelligence
        <span color='#BCB088'>Melee Weapons:</span>      $player.variables.skills.melee_weapons
        <span color='#BCB088'>Ranged Weapons:</span>     $player.variables.skills.ranged_weapons
        <span color='#BCB088'>Sorcery:</span>            $player.variables.skills.sorcery
        <span color='#BCB088'>Nature Magic:</span>        $player.variables.skills.nature_magic
        <span color='#BCB088'>Charisma:</span>           $player.variables.skills.charisma
        <span color='#BCB088'>Literacy:</span>           $player.variables.skills.literacy
        <span color='#BCB088'>Lockpick:</span>           $player.variables.skills.lockpick"

        {CHARACTER_SLOT head "Head"}
        {CHARACTER_SLOT torso "Torso"}
        {CHARACTER_SLOT weapon "Weapon"}
        {CHARACTER_SLOT ranged_weapon "Ranged Weapon"}
        [option]
            message=_ {MENU_IMG_TXT "attacks/blank-attack.png" "<span color='#BCB088' font_size='large'>Spend Skillpoints</span>"}
                        [command]
                            {ADVANCEMENT_MENU}
                        [/command]
                    [/option]
                    [option]
                        image=misc/check.png
                        message=_ {MENU_IMG_TXT "misc/check.png" "<span color='#BCB088' font_size='large'>Done</span>"}
                        [command]
                            [sound]
                                name=UI/menu_launch.ogg
                            [/sound]
                            {VARIABLE finished yes}
                        [/command]
                    [/option]
                [/message]
            [/do]
        [/while]
    [/command]
[/set_menu_item]
#enddef
