#textdomain wesnoth-Undead_in_the_Sewers

#define MOVETO_CONDITIONAL_DIALOGUE MESSAGE VARIABLE X Y RADIUS
    [event]
        name=moveto
        [filter]
            id=$player.id
            [filter_location]
                x={X}
                y={Y}
                radius={RADIUS}
            [/filter_location]
        [/filter]
        [if]
            [variable]
                name={VARIABLE}
                not_equals=done
            [/variable]
            [then]
                [message]
                    speaker=narrator
                    message= _ {MESSAGE}
                [/message]
                [set_variable]
                    name={VARIABLE}
                    value=done
                [/set_variable]
            [/then]
            [else]
            [/else]
        [/if]
    [/event]
#enddef

#define LOCOMOTION_TRANSITION X Y

    #Event for boat/land transformation
    [event]
        name=moveto
        first_time_only=no

        [filter]
            id=$player.id
            [filter_location]
                x={X}
                y={Y}
            [/filter_location]
        [/filter]

        [if]
            [variable]
                name=locomotion
                numerical_equals=1
            [/variable]
            [then]
                [message]
                    speaker=$player.id
                    message= _ "Oh dear, I can't swim!"

                    [option]
                        message = _ "Use the portable boat in your pack."
                        [command]
                            [set_variable]
                                name=locomotion
                                add=1
                            [/set_variable]

                            [store_unit]
                                variable=locomotion_switch_store
                                kill=no
                                [filter]
                                    [filter_location]
                                        x={X}
                                        y={Y}
                                    [/filter_location]
                                [/filter]
                            [/store_unit]

                            [switch]
                                variable=player.type

                                [case]
                                    value=UitS_Human_Warrior

                                    [modify_unit]
                                        [filter]
                                            id=$player.id
                                        [/filter]
                                        type=UitS_Human_Warrior_Aquatic
                                    [/modify_unit]

                                    [modify_unit]
                                        [filter]
                                            id=$player.id
                                        [/filter]
                                        experience=$locomotion_switch_store.experience
                                        hitpoints=$locomotion_switch_store.hitpoints
                                    [/modify_unit]
                                    {CLEAR_VARIABLE locomotion_switch_store}
                                [/case]
                                [case]
                                    value=UitS_Human_Sorcerer_Male

                                    [modify_unit]
                                        [filter]
                                            id=$player.id
                                        [/filter]
                                        type=UitS_Human_Sorcerer_Male_Aquatic
                                    [/modify_unit]

                                    [modify_unit]
                                        [filter]
                                            id=$player.id
                                        [/filter]
                                        experience=$locomotion_switch_store.experience
                                        hitpoints=$locomotion_switch_store.hitpoints
                                    [/modify_unit]
                                    {CLEAR_VARIABLE locomotion_switch_store}
                                [/case]
                                [case]
                                    value=UitS_Human_Sorcerer_Female

                                    [modify_unit]
                                        [filter]
                                            id=$player.id
                                        [/filter]
                                        type=UitS_Human_Sorcerer_Female_Aquatic
                                    [/modify_unit]

                                    [modify_unit]
                                        [filter]
                                            id=$player.id
                                        [/filter]
                                        experience=$locomotion_switch_store.experience
                                        hitpoints=$locomotion_switch_store.hitpoints
                                    [/modify_unit]
                                    {CLEAR_VARIABLE locomotion_switch_store}
                                [/case]
                                [case]
                                    value=UitS_Human_Rogue

                                    [modify_unit]
                                        [filter]
                                            id=$player.id
                                        [/filter]
                                        type=UitS_Human_Rogue_Aquatic
                                    [/modify_unit]

                                    [modify_unit]
                                        [filter]
                                            id=$player.id
                                        [/filter]
                                        experience=$locomotion_switch_store.experience
                                        hitpoints=$locomotion_switch_store.hitpoints
                                    [/modify_unit]

                                    {CLEAR_VARIABLE locomotion_switch_store}
                                [/case]
                                [case]
                                    value=UitS_Human_Shaman_Male

                                    [modify_unit]
                                        [filter]
                                            id=$player.id
                                        [/filter]
                                        type=UitS_Human_Shaman_Male_Aquatic
                                    [/modify_unit]

                                    [modify_unit]
                                        [filter]
                                            id=$player.id
                                        [/filter]
                                        experience=$locomotion_switch_store.experience
                                        hitpoints=$locomotion_switch_store.hitpoints
                                    [/modify_unit]

                                    {CLEAR_VARIABLE locomotion_switch_store}
                                [/case]
                                [case]
                                    value=UitS_Human_Shaman_Female

                                    [modify_unit]
                                        [filter]
                                            id=$player.id
                                        [/filter]
                                        type=UitS_Human_Shaman_Female_Aquatic
                                    [/modify_unit]

                                    [modify_unit]
                                        [filter]
                                            id=$player.id
                                        [/filter]
                                        experience=$locomotion_switch_store.experience
                                        hitpoints=$locomotion_switch_store.hitpoints
                                    [/modify_unit]

                                    {CLEAR_VARIABLE locomotion_switch_store}
                                [/case]

                                # O R C S

                                [case]
                                    value=UitS_Orcish_Warrior

                                    [modify_unit]
                                        [filter]
                                            id=$player.id
                                        [/filter]
                                        type=UitS_Orcish_Warrior_Aquatic
                                    [/modify_unit]

                                    [modify_unit]
                                        [filter]
                                            id=$player.id
                                        [/filter]
                                        experience=$locomotion_switch_store.experience
                                        hitpoints=$locomotion_switch_store.hitpoints
                                    [/modify_unit]

                                    {CLEAR_VARIABLE locomotion_switch_store}
                                [/case]
                                [case]
                                    value=UitS_Orcish_Sorcerer

                                    [modify_unit]
                                        [filter]
                                            id=$player.id
                                        [/filter]
                                        type=UitS_Orcish_Sorcerer_Aquatic
                                    [/modify_unit]

                                    [modify_unit]
                                        [filter]
                                            id=$player.id
                                        [/filter]
                                        experience=$locomotion_switch_store.experience
                                        hitpoints=$locomotion_switch_store.hitpoints
                                    [/modify_unit]

                                    {CLEAR_VARIABLE locomotion_switch_store}
                                [/case]
                                [case]
                                    value=UitS_Orcish_Rogue

                                    [modify_unit]
                                        [filter]
                                            id=$player.id
                                        [/filter]
                                        type=UitS_Orcish_Rogue_Aquatic
                                    [/modify_unit]

                                    [modify_unit]
                                        [filter]
                                            id=$player.id
                                        [/filter]
                                        experience=$locomotion_switch_store.experience
                                        hitpoints=$locomotion_switch_store.hitpoints
                                    [/modify_unit]

                                    {CLEAR_VARIABLE locomotion_switch_store}
                                [/case]
                                [case]
                                    value=UitS_Orcish_Shaman

                                    [modify_unit]
                                        [filter]
                                            id=$player.id
                                        [/filter]
                                        type=UitS_Orcish_Shaman_Aquatic
                                    [/modify_unit]

                                    [modify_unit]
                                        [filter]
                                            id=$player.id
                                        [/filter]
                                        experience=$locomotion_switch_store.experience
                                        hitpoints=$locomotion_switch_store.hitpoints
                                    [/modify_unit]

                                    {CLEAR_VARIABLE locomotion_switch_store}
                                [/case]

                                # E L V E S

                                [case]
                                    value=UitS_Elvish_Warrior

                                    [modify_unit]
                                        [filter]
                                            id=$player.id
                                        [/filter]
                                        type=UitS_Elvish_Warrior_Aquatic
                                    [/modify_unit]

                                    [modify_unit]
                                        [filter]
                                            id=$player.id
                                        [/filter]
                                        experience=$locomotion_switch_store.experience
                                        hitpoints=$locomotion_switch_store.hitpoints
                                    [/modify_unit]

                                    {CLEAR_VARIABLE locomotion_switch_store}
                                [/case]
                                [case]
                                    value=UitS_Elvish_Sorcerer

                                    [modify_unit]
                                        [filter]
                                            id=$player.id
                                        [/filter]
                                        type=UitS_Elvish_Sorcerer_Aquatic
                                    [/modify_unit]

                                    [modify_unit]
                                        [filter]
                                            id=$player.id
                                        [/filter]
                                        experience=$locomotion_switch_store.experience
                                        hitpoints=$locomotion_switch_store.hitpoints
                                    [/modify_unit]

                                    {CLEAR_VARIABLE locomotion_switch_store}
                                [/case]
                                [case]
                                    value=UitS_Elvish_Rogue_Male

                                    [modify_unit]
                                        [filter]
                                            id=$player.id
                                        [/filter]
                                        type=UitS_Elvish_Rogue_Male_Aquatic
                                    [/modify_unit]

                                    [modify_unit]
                                        [filter]
                                            id=$player.id
                                        [/filter]
                                        experience=$locomotion_switch_store.experience
                                        hitpoints=$locomotion_switch_store.hitpoints
                                    [/modify_unit]

                                    {CLEAR_VARIABLE locomotion_switch_store}
                                [/case]
                                [case]
                                    value=UitS_Elvish_Rogue_Female

                                    [modify_unit]
                                        [filter]
                                            id=$player.id
                                        [/filter]
                                        type=UitS_Elvish_Rogue_Female_Aquatic
                                    [/modify_unit]

                                    [modify_unit]
                                        [filter]
                                            id=$player.id
                                        [/filter]
                                        experience=$locomotion_switch_store.experience
                                        hitpoints=$locomotion_switch_store.hitpoints
                                    [/modify_unit]

                                    {CLEAR_VARIABLE locomotion_switch_store}
                                [/case]
                                [case]
                                    value=UitS_Elvish_Shaman

                                    [modify_unit]
                                        [filter]
                                            id=$player.id
                                        [/filter]
                                        type=UitS_Elvish_Shaman_Aquatic
                                    [/modify_unit]

                                    [modify_unit]
                                        [filter]
                                            id=$player.id
                                        [/filter]
                                        experience=$locomotion_switch_store.experience
                                        hitpoints=$locomotion_switch_store.hitpoints
                                    [/modify_unit]

                                    {CLEAR_VARIABLE locomotion_switch_store}
                                [/case]

                                [else]
                                [/else]
                            [/switch]
                        [/command]
                    [/option]

                    [option]
                        message = _ "Do nothing."
                        [command]
                        [/command]
                    [/option]
                [/message]
            [/then]

            [else]
                [message]
                    speaker=$player.id
                    message= _ "Oh dear, I can't move around on land in a boat!"

                    [option]
                        message = _ "Put the portable boat back in your pack."
                        [command]
                            [set_variable]
                                name=locomotion
                                add=-1
                            [/set_variable]

                            [store_unit]
                                variable=locomotion_switch_store
                                kill=no
                                [filter]
                                    id=$player.id
                                [/filter]
                            [/store_unit]

                            [switch]
                                variable=locomotion_switch_store.type
                                [case]
                                    value=UitS_Human_Warrior_Aquatic

                                    [modify_unit]
                                        [filter]
                                            id=$player.id
                                        [/filter]
                                        type=UitS_Human_Warrior
                                    [/modify_unit]

                                    [modify_unit]
                                        [filter]
                                            id=$player.id
                                        [/filter]
                                        experience=$locomotion_switch_store.experience
                                        hitpoints=$locomotion_switch_store.hitpoints
                                    [/modify_unit]

                                    {CLEAR_VARIABLE locomotion_switch_store}
                                [/case]
                                [case]
                                    value=UitS_Human_Sorcerer_Male_Aquatic

                                    [modify_unit]
                                        [filter]
                                            id=$player.id
                                        [/filter]
                                        type=UitS_Human_Sorcerer_Male
                                    [/modify_unit]

                                    [modify_unit]
                                        [filter]
                                            id=$player.id
                                        [/filter]
                                        experience=$locomotion_switch_store.experience
                                        hitpoints=$locomotion_switch_store.hitpoints
                                    [/modify_unit]

                                    {CLEAR_VARIABLE locomotion_switch_store}
                                [/case]
                                [case]
                                    value=UitS_Human_Sorcerer_Female_Aquatic

                                    [modify_unit]
                                        [filter]
                                            id=$player.id
                                        [/filter]
                                        type=UitS_Human_Sorcerer_Female
                                    [/modify_unit]

                                    [modify_unit]
                                        [filter]
                                            id=$player.id
                                        [/filter]
                                        experience=$locomotion_switch_store.experience
                                        hitpoints=$locomotion_switch_store.hitpoints
                                    [/modify_unit]

                                    {CLEAR_VARIABLE locomotion_switch_store}
                                [/case]
                                [case]
                                    value=UitS_Human_Rogue_Aquatic

                                    [modify_unit]
                                        [filter]
                                            id=$player.id
                                        [/filter]
                                        type=UitS_Human_Rogue
                                    [/modify_unit]

                                    [modify_unit]
                                        [filter]
                                            id=$player.id
                                        [/filter]
                                        experience=$locomotion_switch_store.experience
                                        hitpoints=$locomotion_switch_store.hitpoints
                                    [/modify_unit]

                                    {CLEAR_VARIABLE locomotion_switch_store}
                                [/case]
                                [case]
                                    value=UitS_Human_Shaman_Male_Aquatic

                                    [modify_unit]
                                        [filter]
                                            id=$player.id
                                        [/filter]
                                        type=UitS_Human_Shaman_Male
                                    [/modify_unit]

                                    [modify_unit]
                                        [filter]
                                            id=$player.id
                                        [/filter]
                                        experience=$locomotion_switch_store.experience
                                        hitpoints=$locomotion_switch_store.hitpoints
                                    [/modify_unit]

                                    {CLEAR_VARIABLE locomotion_switch_store}
                                [/case]
                                [case]
                                    value=UitS_Human_Shaman_Female_Aquatic

                                    [modify_unit]
                                        [filter]
                                            id=$player.id
                                        [/filter]
                                        type=UitS_Human_Shaman_Female
                                    [/modify_unit]

                                    [modify_unit]
                                        [filter]
                                            id=$player.id
                                        [/filter]
                                        experience=$locomotion_switch_store.experience
                                        hitpoints=$locomotion_switch_store.hitpoints
                                    [/modify_unit]

                                    {CLEAR_VARIABLE locomotion_switch_store}
                                [/case]

                                # O R C S

                                [case]
                                    value=UitS_Orcish_Warrior_Aquatic

                                    [modify_unit]
                                        [filter]
                                            id=$player.id
                                        [/filter]
                                        type=UitS_Orcish_Warrior
                                    [/modify_unit]

                                    [modify_unit]
                                        [filter]
                                            id=$player.id
                                        [/filter]
                                        experience=$locomotion_switch_store.experience
                                        hitpoints=$locomotion_switch_store.hitpoints
                                    [/modify_unit]

                                    {CLEAR_VARIABLE locomotion_switch_store}
                                [/case]
                                [case]
                                    value=UitS_Orcish_Sorcerer_Aquatic

                                    [modify_unit]
                                        [filter]
                                            id=$player.id
                                        [/filter]
                                        type=UitS_Orcish_Sorcerer
                                    [/modify_unit]

                                    [modify_unit]
                                        [filter]
                                            id=$player.id
                                        [/filter]
                                        experience=$locomotion_switch_store.experience
                                        hitpoints=$locomotion_switch_store.hitpoints
                                    [/modify_unit]

                                    {CLEAR_VARIABLE locomotion_switch_store}
                                [/case]
                                [case]
                                    value=UitS_Orcish_Rogue_Aquatic

                                    [modify_unit]
                                        [filter]
                                            id=$player.id
                                        [/filter]
                                        type=UitS_Orcish_Rogue
                                    [/modify_unit]

                                    [modify_unit]
                                        [filter]
                                            id=$player.id
                                        [/filter]
                                        experience=$locomotion_switch_store.experience
                                        hitpoints=$locomotion_switch_store.hitpoints
                                    [/modify_unit]

                                    {CLEAR_VARIABLE locomotion_switch_store}
                                [/case]
                                [case]
                                    value=UitS_Orcish_Shaman_Aquatic

                                    [modify_unit]
                                        [filter]
                                            id=$player.id
                                        [/filter]
                                        type=UitS_Orcish_Shaman
                                    [/modify_unit]

                                    [modify_unit]
                                        [filter]
                                            id=$player.id
                                        [/filter]
                                        experience=$locomotion_switch_store.experience
                                        hitpoints=$locomotion_switch_store.hitpoints
                                    [/modify_unit]

                                    {CLEAR_VARIABLE locomotion_switch_store}
                                [/case]

                                # E L V E S
                                [case]
                                    value=UitS_Elvish_Warrior_Aquatic

                                    [modify_unit]
                                        [filter]
                                            id=$player.id
                                        [/filter]
                                        type=UitS_Elvish_Warrior
                                    [/modify_unit]

                                    [modify_unit]
                                        [filter]
                                            id=$player.id
                                        [/filter]
                                        experience=$locomotion_switch_store.experience
                                        hitpoints=$locomotion_switch_store.hitpoints
                                    [/modify_unit]

                                    {CLEAR_VARIABLE locomotion_switch_store}
                                [/case]
                                [case]
                                    value=UitS_Elvish_Sorcerer_Aquatic

                                    [modify_unit]
                                        [filter]
                                            id=$player.id
                                        [/filter]
                                        type=UitS_Elvish_Sorcerer
                                    [/modify_unit]

                                    [modify_unit]
                                        [filter]
                                            id=$player.id
                                        [/filter]
                                        experience=$locomotion_switch_store.experience
                                        hitpoints=$locomotion_switch_store.hitpoints
                                    [/modify_unit]

                                    {CLEAR_VARIABLE locomotion_switch_store}
                                [/case]
                                [case]
                                    value=UitS_Elvish_Rogue_Male_Aquatic

                                    [modify_unit]
                                        [filter]
                                            id=$player.id
                                        [/filter]
                                        type=UitS_Elvish_Rogue_Male
                                    [/modify_unit]

                                    [modify_unit]
                                        [filter]
                                            id=$player.id
                                        [/filter]
                                        experience=$locomotion_switch_store.experience
                                        hitpoints=$locomotion_switch_store.hitpoints
                                    [/modify_unit]

                                    {CLEAR_VARIABLE locomotion_switch_store}
                                [/case]
                                [case]
                                    value=UitS_Elvish_Rogue_Male_Femquatic

                                    [modify_unit]
                                        [filter]
                                            id=$player.id
                                        [/filter]
                                        type=UitS_Elvish_Rogue_Female
                                    [/modify_unit]

                                    [modify_unit]
                                        [filter]
                                            id=$player.id
                                        [/filter]
                                        experience=$locomotion_switch_store.experience
                                        hitpoints=$locomotion_switch_store.hitpoints
                                    [/modify_unit]

                                    {CLEAR_VARIABLE locomotion_switch_store}
                                [/case]
                                [case]
                                    value=UitS_Elvish_Shaman_Aquatic

                                    [modify_unit]
                                        [filter]
                                            id=$player.id
                                        [/filter]
                                        type=UitS_Elvish_Shaman
                                    [/modify_unit]

                                    [modify_unit]
                                        [filter]
                                            id=$player.id
                                        [/filter]
                                        experience=$locomotion_switch_store.experience
                                        hitpoints=$locomotion_switch_store.hitpoints
                                    [/modify_unit]

                                    {CLEAR_VARIABLE locomotion_switch_store}
                                [/case]
                                [else]
                                [/else]
                            [/switch]
                        [/command]
                    [/option]

                    [option]
                        message = _ "Do nothing."
                        [command]
                        [/command]
                    [/option]
                [/message]
            [/else]
        [/if]
    [/event]

#enddef

#define DANGEROUS_SEWAGE

    ##SINKING IN sewage!!! Stolen from DiD

    [event]
        name=moveto

        [filter]
            side=1

            [not]
                type=Ghost,Wraith,Spectre,Shadow,Nightgaunt,Vampire Bat,Blood Bat,Dread Bat
            [/not]

            [filter_location]
                terrain=Wwf
            [/filter_location]
        [/filter]

        [if]
            [variable]
                name=sewage_warning
                numerical_equals=1
            [/variable]
            [then]
            [/then]
            [else]
                [message]
                    speaker=$player.id
                    message=_ "Whoa! I'd better be careful, the sewage here is like sinking sand! The next one who steps in that will probably get sucked under!"
                [/message]

                [message]
                    speaker=$player.id
                    message=_ "Hmm, the sewage seems to get darker where I stepped in it. I should be fine as long as I avoid the dark sewage."
                [/message]

                [message]
                    speaker=narrator
                    message=_ "If you end your turn in light sewage, the hex you are standing on will become deep sewage (the hex will turn dark brown to both signify this change and to warn you where the deep sewage is). If you end your turn in deep sewage, you will sink and drown. Choose wisely where you place your feet!"
                    image=wesnoth-icon.png
                [/message]

                [set_variable]
                    name=sewage_warning
                    add=1
                [/set_variable]
            [/else]
        [/if]
    [/event]

    [event]
        name=new turn
        first_time_only=no

        [store_locations]
            [filter]
                [not]
                    type=Ghost,Wraith,Spectre,Shadow,Nightgaunt,Vampire Bat,Blood Bat,Dread Bat
                [/not]
            [/filter]

            find_in=weakened_sewage

            variable=breaking_sewage
        [/store_locations]

        {FOREACH breaking_sewage i}
            [terrain]
                x,y=$breaking_sewage[$i].x,$breaking_sewage[$i].y
                terrain=Sm
            [/terrain]

            [redraw]
            [/redraw]

            [kill]
                x,y=$breaking_sewage[$i].x,$breaking_sewage[$i].y
                animate=yes
                fire_event=yes
            [/kill]

            [if]
                [filter]
                    side=1
                [/filter]

                [then]
                    [message]
                        speaker=narrator
                        message=_ "The unit sinks into the thick, cloying mass of sewage."
                        image=wesnoth-icon.png
                    [/message]
                [/then]
                [else]
                [/else]
            [/if]
        {NEXT i}

        [store_locations]
            terrain=Wwf

            [filter]
                [not]
                    type=Ghost,Wraith,Spectre,Shadow,Nightgaunt,Vampire Bat,Blood Bat,Dread Bat
                [/not]
            [/filter]

            [or]
                terrain=Sm

                find_in=weakened_sewage
            [/or]

            variable=weakened_sewage
        [/store_locations]

        {FOREACH weakened_sewage i}
            [terrain]
                x,y=$weakened_sewage[$i].x,$weakened_sewage[$i].y
                terrain=Sm
            [/terrain]
        {NEXT i}

        {CLEAR_VARIABLE breaking_sewage}
    [/event]

#enddef

#define ANIMATED_FOUNTAIN X Y
    [terrain_graphics]
        x={X}
        y={Y}
        [tile]
            x=0
            y=0
            [image]
                layer=0
                name="scenery/fountain-animated-1:140,scenery/fountain-animated-2:140,scenery/fountain-animated-3:140,scenery/fountain-animated-4:140"
            [/image]
        [/tile]
    [/terrain_graphics]
#enddef

#define NPC_SPAWN_CHECK TYPE ID X Y VARIATION

    [if]
        [variable]
            name={ID}_dead
            numerical_equals=2
        [/variable]
        [then]
        [/then]
        [else]
            [unit]
                side=2
                type={TYPE}
                id={ID}
                variation={VARIATION}
                x={X}
                y={Y}
                ai_special=guardian
            [/unit]
        [/else]
    [/if]

    [event]
        name=die
        [filter]
            id={ID}
        [/filter]

        [store_unit]
            [filter]
                id={ID}
            [/filter]
            kill=yes
            animate=yes
            variable={ID}_store
        [/store_unit]

        [switch]
            variable={ID}_store.type
            [case]
                value="Walking Corpse"

                [set_variable]
                    name=WC_kill_count
                    add=1
                [/set_variable]

                [if]
                    [variable]
                        name=WC_kill_count
                        numerical_equals=10
                    [/variable]
                    [then]
                        [sound]
                            name=achievement.ogg
                        [/sound]
                        [object]
                            [filter]
                            [/filter]
                            name= _ ""
                            description= _ "<span color='#BCB088' size='large'>Congratulations, you have unlocked the achievement</span>
              
<span color='#a90000' size='large'>                         Zombie Slayer </span> 
          
<span color='#BCB088'>                    by killing 10 Walking Corpses!                                            

                                                            
The 'Zombie Slayer' trophy has been added to the trophy hall!</span>"
                            image=trophies/zombie_slayer_trophy.png
                        [/object]

                        [set_variable]
                            name=Zombie_Slayer_Trophy
                            add=2
                        [/set_variable]
                    [/then]
                    [else]
                    [/else]
                [/if]

                {CLEAR_VARIABLE {ID}_store}

                ################
            [/case]
            [else]
            [/else]
        [/switch]

        [set_variable]
            name={ID}_dead
            add=2
        [/set_variable]

        #{CLEAR_VARIABLE {ID}_die_loc.type}
    [/event]

#enddef
