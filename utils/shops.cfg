#textdomain wesnoth-Undead_in_the_Sewers

#define SELL_ITEM ID

    [option]
        [show_if]
            [variable]
                name=player.variables.inventory.{ID}
                greater_than_equal_to=1
            [/variable]
        [/show_if]
        message = _ {MENU_IMG_TXT "$items.{ID}.icon" "<span color='#BCB088' size='large' weight='bold' >$items.{ID}.name</span>
<span color='#BCB088' size='small' >Weight:</span> <span size='small' >$items.{ID}.weight pounds</span>
                                   $items.{ID}.sell_price                    $player.variables.inventory.{ID}"}
        [command]
            [message]
                speaker=narrator
                message = _ "How many do you want to sell?"
                [text_input]
                    variable=amount_to_sell
                    label= _ "<span color='#BCB088'>Amount:</span> "
                text=_ "$player.variables.inventory.{ID}"
            [/text_input]
        [/message]

            [if]
                [variable]
                    name=amount_to_sell
                    greater_than=$player.variables.inventory.{ID}
                [/variable]
                [then]
                    [set_variable]
                        name=amount_to_sell
                        value=$player.variables.inventory.{ID}
                    [/set_variable]
                [/then]
                [else]
                [/else]
            [/if]

            [set_variable]
                name=player.variables.inventory.{ID}
                sub=$amount_to_sell
            [/set_variable]

#here we remove however many pounds the equation "individual weight of the item being sold times the amount of that item being sold" comes out to be
            [set_variable]
                name=weight_lost
                value=$amount_to_sell
            [/set_variable]

            {VARIABLE_OP weight_lost multiply $items.{ID}.weight}

            [set_variable]
                name=player.variables.carrying_pounds
                sub=$weight_lost
            [/set_variable]

#debug message
#[message]
#speaker=narrator
#message= _ "Weight lost: $weight_lost"
#[/message]

            {CLEAR_VARIABLE weight_lost}
            {VARIABLE_OP amount_to_sell multiply $items.{ID}.sell_price}

            [gold]
                side=1
                amount=$amount_to_sell
            [/gold]

            [sound]
                name=gold.ogg
            [/sound]

            {CLEAR_VARIABLE amount_to_sell}
        [/command]
    [/option]
#enddef




#define BUY_ITEM ID PRICE
         [option]
            message=_ {MENU_IMG_TXT "$items.{ID}.icon" "<span color='#BCB088' size='large' weight='bold' >$items.{ID}.name</span>
    <span color='#BCB088' size='small' >Weight:</span> <span size='small' >$items.{ID}.weight pounds</span>
    <span color='#009418' size='small' >$items.{ID}.description</span> $items.{ID}.buy_UI_separator <span color='#BCB088' >Cost: $items.{ID}.buy_price_{PRICE} gold</span>
<span color='#a30000' size='small'>$items.{ID}.required_description</span>"}
    [command]
        [if]
            [variable]
                name=gold
                greater_than_equal_to=$items.{ID}.buy_price_{PRICE}
            [/variable]
            [then]
                [set_variable]
                    name=possible_weight
                    add=$items.{ID}.weight
                [/set_variable]

                [set_variable]
                    mode=replace
                    delayed_variable_substitution=no
                    name=possible_weight
                    add=$player.variables.carrying_pounds
                [/set_variable]

                #this message used for debugging purposes
                #[message]
                #speaker=narrator
                #message= _ "Possible weight is $items.{ID}.weight pounds for the item, plus the $player.variables.carrying_pounds pounds you are already carrying. The sum of the potential weight is: $possible_weight pounds.

                #The maximum amount of weight you can carry is $player.variables.max_carry_pounds pounds."
                #[/message]

                [if]
                    [variable]
                        name=possible_weight
                        greater_than=$player.variables.max_carry_pounds
                    [/variable]
                    [then]
                        [message]
                            speaker=narrator
                            message= _ "You reach for the gold needed to purchase the item, then realize that your pack will be too heavy to carry if you add the item to it. Regretfully, you decide not to purchase the item until you are able to carry more weight."
                        [/message]

                        {CLEAR_VARIABLE possible_weight}
                    [/then]
                    [else]
                        [gold]
                            amount=-"$items.{ID}.buy_price_{PRICE}"
                            side=$side_number
                        [/gold]

                        [set_variable]
                            name=player.variables.inventory.{ID}
                            add=1
                        [/set_variable]

                        [set_variable]
                            name=player.variables.carrying_pounds
                            add=$items.{ID}.weight
                        [/set_variable]

                        [sound]
                            name=gold.ogg
                        [/sound]

                        [message]
                            speaker=narrator
                            message=_ "You purchase a $items.{ID}.context_name for $items.{ID}.buy_price_{PRICE} gold."
                            image=$items.{ID}.icon
                        [/message]

                        {CLEAR_VARIABLE possible_weight}
                    [/else]
                [/if]
            [/then]
            [else]
                [message]
                    speaker=narrator
                    message=_ "You don't have enough gold to purchase that item."
                [/message]
            [/else]
        [/if]
    [/command]
[/option]
#enddef

#define MAGIC_SHOP X Y
    [event]
        name=moveto
        first_time_only=no

        [filter]
            id=$player.id
            [filter_location]
                x,y={X},{Y}
            [/filter_location]
        [/filter]

        [message]
            speaker=narrator
            caption=Apprentice Slousk
            image=portraits/humans/transparent/mage-white.png
            message= _ "Sorry, we're not open for business at this time. Maybe in the next version."
        [/message]
    [/event]

#enddef

#define JABBON_POTIONMASTER X Y
    [event]
        name=moveto
        first_time_only=no
        [filter]
            x={X}
            y={Y}
        [/filter]

        {VARIABLE main_done no}

        [while]
            [variable]
                name=main_done
                equals=no
            [/variable]
            [do]
                [message]
                    speaker=narrator
                    caption=Jabbon Potionmaster
                    message=_ "Greetings, $player.name. How may I help you?"
                    image=portraits/HakimTrans.png
                    [option]
                        message = _ "1. I'd like to see your wares."
                        [command]
                            [fire_event]
                                name=jabbon_shop_event
                            [/fire_event]
                        [/command]
                    [/option]

                    [option]
                        message = _ "2. Can I sell something to you?"
                        [command]
                            [set_variable]
                                name=selling_done
                                value=no
                            [/set_variable]

                            [while]
                                [variable]
                                    name=selling_done
                                    equals=no
                                [/variable]
                                [do]
                                    [message]
                                        speaker=narrator
                                        caption="Jabbon Potionmaster"
                                        image=portraits/HakimTrans.png
                                        message= _ "I'm not interested in weapons or armor or magical trinkets. However, I will buy any alchemical ingredients or surplus potions you may have to offer.
                                                                                    

<span color='#BCB088' >Carrying $player.variables.carrying_pounds/$player.variables.max_carry_pounds pounds</span>

<span color='#BCB088' >Item                                             Price            You have</span>"

                                        {SELL_ITEM health_potion}
                                        {SELL_ITEM movement_potion}
                                        {SELL_ITEM curing_potion}

                                        [option]
                                            message = _ {MENU_IMG_TXT "misc/check.png" "That's all for now (finish selling)."}
                                            [command]
                                                {VARIABLE selling_done yes}
                                            [/command]
                                        [/option]
                                    [/message]
                                [/do]
                            [/while]
                        [/command]
                    [/option]
                    [option]
                        message = _ "3. Good day (end conversation)."
                        [command]
                            {VARIABLE main_done yes}
                        [/command]
                    [/option]
                [/message]
            [/do]
        [/while]
    [/event]

    [event]
        name=jabbon_shop_event
        first_time_only=no

        [set_variable]
            name=sub_done
            value=no
        [/set_variable]

        [while]
            [variable]
                name=sub_done
                equals=no
            [/variable]
            [do]
                [store_gold]
                    side=1
                    variable=gold
                [/store_gold]

                [message]
                    speaker=narrator
                    caption=Jabbon Potionmaster's Wares
                    message=_ "Prices: Average
<span color='#BCB088' >Carrying $player.variables.carrying_pounds/$player.variables.max_carry_pounds pounds</span>"

{BUY_ITEM health_potion average}
{BUY_ITEM movement_potion average}
{BUY_ITEM curing_potion average}

                    [option]
                        message = _ {MENU_IMG_TXT "misc/check.png" "That's all I need for now."}
                        [command]
                            [set_variable]
                                name=sub_done
                                value=yes
                            [/set_variable]
                        [/command]
                    [/option]
                [/message]
            [/do]
        [/while]
    [/event]
#enddef

#define BRAKKON_FORGEMASTER X Y
    [event]
        name=moveto
        first_time_only=no
        [filter]
            x={X}
            y={Y}
        [/filter]

        {VARIABLE main_done no}

        [while]
            [variable]
                name=main_done
                equals=no
            [/variable]
            [do]
                [message]
                    speaker=narrator
                    caption=Brakkon Forgemaster
                    message=_ "G'day, $player.name. What can Ah do for ye?"
                    image=portraits/dwarves/transparent/runemaster.png
                    [option]
                        message = _ "1. I'd like to see your wares."

                        [command]
                            [fire_event]
                                name=brakkon_shop_event
                            [/fire_event]
                        [/command]
                    [/option]

                    [option]
                        message = _ "2. Can I sell something to you?"
                        [command]
                            [set_variable]
                                name=selling_done
                                value=no
                            [/set_variable]

                            [while]
                                [variable]
                                    name=selling_done
                                    equals=no
                                [/variable]
                                [do]
                                    [message]
                                        speaker=narrator
                                        caption="Brakkon Forgemaster"
                                        image=portraits/dwarves/transparent/runemaster.png
                                        message= _ "Ah have no use for any magical baubles or potions, but Ah'll offer ye good, solid gold coin on any weapons or armor ye may wish tah offer.
                                                                                    

<span color='#BCB088' >Carrying $player.variables.carrying_pounds/$player.variables.max_carry_pounds pounds</span>

<span color='#BCB088' >Item                                             Price            You have</span>"

                                        {SELL_ITEM "dented_helm"}
                                        {SELL_ITEM "shining_helm"}
                                        {SELL_ITEM "bascinet"}
                                        {SELL_ITEM "leather_armor"}
                                        {SELL_ITEM "chainmail_tunic"}
                                        {SELL_ITEM "burnished_breastplate"}
                                        {SELL_ITEM "steel_breastplate"}
                                        {SELL_ITEM "short_sword"}
                                        {SELL_ITEM "bastard_sword"}
                                        {SELL_ITEM "longsword"}
                                        {SELL_ITEM "greatsword"}
                                        {SELL_ITEM "broadsword"}
                                        {SELL_ITEM "shortbow"}
                                        {SELL_ITEM "yew_bow"}
                                        {SELL_ITEM "compound_bow"}
                                        {SELL_ITEM "longbow"}

                                        [option]
                                            message = _ {MENU_IMG_TXT "misc/check.png" "That's all for now (finish selling)."}
                                            [command]
                                                [set_variable]
                                                    name=selling_done
                                                    value=yes
                                                [/set_variable]
                                            [/command]
                                        [/option]
                                    [/message]
                                [/do]
                            [/while]
                        [/command]
                    [/option]

                    [option]
                        message = _ "3. Good day (end conversation)."
                        [command]
                            {VARIABLE main_done yes}
                        [/command]
                    [/option]
                [/message]
            [/do]
        [/while]
    [/event]

    [event]
        name=brakkon_shop_event
        first_time_only=no

        [set_variable]
            name=sub_done
            value=no
        [/set_variable]

        [while]
            [variable]
                name=sub_done
                equals=no
            [/variable]
            [do]

                [message]
                    speaker=narrator
                    caption=Brakkon Forgemaster's Wares
                    message=_ "Prices: Average
<span color='#BCB088' >Carrying $player.variables.carrying_pounds/$player.variables.max_carry_pounds pounds</span>"

                    [option]
                        message= _ {MENU_IMG_TXT "icons/helmet_bascinet.png" "Helmets"}
                        [command]
                            [set_variable]
                                name=sub_sub_done
                                value=no
                            [/set_variable]
                            [while]
                                [variable]
                                    name=sub_sub_done
                                    equals=no
                                [/variable]
                                [do]
                                    [store_gold]
                                        side=1
                                        variable=gold
                                    [/store_gold]

                                    [message]
                                        speaker=narrator
                                        caption="Brakkon Forgemaster's Wares (Helmets)"
                                        message=_ "Prices: Average
<span color='#BCB088' >Carrying $player.variables.carrying_pounds/$player.variables.max_carry_pounds pounds</span>"

                    {BUY_ITEM "dented_helm" "average"}
                    {BUY_ITEM "shining_helm" "average"}
                    {BUY_ITEM "bascinet" "average"}

                                        [option]
                                            message= _ {MENU_IMG_TXT "misc/back.png" "Back"}
                                            [command]
                                                [set_variable]
                                                    name=sub_sub_done
                                                    value=yes
                                                [/set_variable]
                                                {CLEAR_VARIABLE sub_sub_done}
                                            [/command]
                                        [/option]
                                    [/message]
                                [/do]
                            [/while]
                        [/command]
                    [/option]

                    [option]
                        message= _ {MENU_IMG_TXT "icons/breastplate.png" "Armor"}
                        [command]
                            [set_variable]
                                name=sub_sub_done
                                value=no
                            [/set_variable]
                            [while]
                                [variable]
                                    name=sub_sub_done
                                    equals=no
                                [/variable]
                                [do]
                                    [store_gold]
                                        side=1
                                        variable=gold
                                    [/store_gold]

                                    [message]
                                        speaker=narrator
                                        caption="Brakkon Forgemaster's Wares (Armor)"
                                        message=_ "Prices: Average
<span color='#BCB088' >Carrying $player.variables.carrying_pounds/$player.variables.max_carry_pounds pounds</span>"

                    {BUY_ITEM "leather_armor" "average"}
                    {BUY_ITEM "chainmail_tunic" "average"}
                    {BUY_ITEM "burnished_breastplate" "average"}
                    {BUY_ITEM "steel_breastplate" "average"}

                                        [option]
                                            message= _ {MENU_IMG_TXT "misc/back.png" "Back"}
                                            [command]
                                                [set_variable]
                                                    name=sub_sub_done
                                                    value=yes
                                                [/set_variable]
                                                {CLEAR_VARIABLE sub_sub_done}
                                            [/command]
                                        [/option]
                                    [/message]
                                [/do]
                            [/while]
                        [/command]
                    [/option]

                    [option]
                        message= _ {MENU_IMG_TXT "attacks/sword-human.png" "Melee Weapons"}
                        [command]
                            [set_variable]
                                name=sub_sub_done
                                value=no
                            [/set_variable]
                            [while]
                                [variable]
                                    name=sub_sub_done
                                    equals=no
                                [/variable]
                                [do]
                                    [store_gold]
                                        side=1
                                        variable=gold
                                    [/store_gold]

                                    [message]
                                        speaker=narrator
                                        caption="Brakkon Forgemaster's Wares (Melee Weapons)"
                                        message=_ "Prices: Average
<span color='#BCB088' >Carrying $player.variables.carrying_pounds/$player.variables.max_carry_pounds pounds</span>"

                                        {BUY_ITEM "short_sword" "average"}
                                        {BUY_ITEM "bastard_sword" "average"}
                                        {BUY_ITEM "longsword" "average"}
                                        {BUY_ITEM "greatsword" "average"}
                                        {BUY_ITEM "broadsword" "average"}

                                        [option]
                                            message= _ {MENU_IMG_TXT "misc/back.png" "Back"}
                                            [command]
                                                [set_variable]
                                                    name=sub_sub_done
                                                    value=yes
                                                [/set_variable]
                                                {CLEAR_VARIABLE sub_sub_done}
                                            [/command]
                                        [/option]
                                    [/message]
                                [/do]
                            [/while]
                        [/command]
                    [/option]

                    [option]
                        message= _ {MENU_IMG_TXT "attacks/bow.png" "Ranged Weapons"}
                        [command]
                            [set_variable]
                                name=sub_sub_done
                                value=no
                            [/set_variable]
                            [while]
                                [variable]
                                    name=sub_sub_done
                                    equals=no
                                [/variable]
                                [do]
                                    [store_gold]
                                        side=1
                                        variable=gold
                                    [/store_gold]

                                    [message]
                                        speaker=narrator
                                        caption="Brakkon Forgemaster's Wares (Ranged Weapons)"
                                        message=_ "Prices: Average
<span color='#BCB088' >Carrying $player.variables.carrying_pounds/$player.variables.max_carry_pounds pounds</span>"

                                        {BUY_ITEM "shortbow" "average"}
                                        {BUY_ITEM "yew_bow" "average"}
                                        {BUY_ITEM "compound_bow" "average"}
                                        {BUY_ITEM "longbow" "average"}

                                        [option]
                                            message= _ {MENU_IMG_TXT "misc/back.png" "Back"}
                                            [command]
                                                [set_variable]
                                                    name=sub_sub_done
                                                    value=yes
                                                [/set_variable]
                                                {CLEAR_VARIABLE sub_sub_done}
                                            [/command]
                                        [/option]
                                    [/message]
                                [/do]
                            [/while]
                        [/command]
                    [/option]

                    [option]
                        message = _ {MENU_IMG_TXT "misc/check.png" "That's all I need for now (end shopping)."}
                        [command]
                            [set_variable]
                                name=sub_done
                                value=yes
                            [/set_variable]
                        [/command]
                    [/option]
                [/message]
            [/do]
        [/while]
    [/event]
#enddef

#Gwint the Tinker

#define GWINT_THE_TINKER X Y
    [event]
        name=moveto
        first_time_only=no
        [filter]
            x={X}
            y={Y}
        [/filter]

        {VARIABLE main_done no}

        [while]
            [variable]
                name=main_done
                equals=no
            [/variable]
            [do]
                [message]
                    speaker=narrator
                    caption=Jabbon Potionmaster
                    message=_ "Greetings, $player.name. How may I help you?"
                    image=portraits/HakimTrans.png
                    [option]
                        message = _ "1. I'd like to see your wares."

                        [command]
                        [/command]
                    [/option]
                [/message]
            [/event]
#enddef
